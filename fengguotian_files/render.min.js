define("render",["lodash","utils","core","reactDOM"],function(a,b,c,d){"use strict";var e=typeof window!=="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);function f(a,b){var c=b.query;var d=c.configName||"fullFunctionality";var e=a[d]||a.fullFunctionality;var f=e.getConfig();if(!c.dsOrigin){throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key")}f.origin=c.dsOrigin;return f}function g(c,d,e){var f=a(e).keys().pull("masterPage").value();return a.mapValues(e,function(a,e){if(d&&window.pagesData&&window.pagesData[e]){return a}return b.dataFixer.fix(a,f.slice(),c.requestModel,c.currentUrl,c.urlFormatModel)})}function h(b,f,g,h,i){c.renderer.renderSite(f,g,h,function(c){if(window.rendered){window.rendered.forceUpdate()}else{var f=document.getElementById("SITE_CONTAINER").children[0];window.rendered=d.render(c,document.getElementById("SITE_CONTAINER"));var g=document.getElementById("SITE_CONTAINER").children[0];if(window.sssr){window.sssr.success=f===g;window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:e()}}window.onpopstate=window.rendered.onPopState;window.onhashchange=window.rendered.onHashChange;if(window.parent){window.rendered.registerAspectToEvent("siteReady",function(){if(window.documentServices&&i){i(window.rendered)}window.parent.postMessage("documentServicesLoaded","*")})}if(b.qaAutomation){a.set(window,"testApi.domSelectors",b.qaAutomation.getDomSelectors(b.react,b.reactDOM));window.testApi.domSelectors.setSearchRoot(window.rendered);a.set(window,"testApi.isReady",true)}}})}function i(d,e,i,j,k){var l=d.documentServices;var m={};if(b.urlUtils.isQueryParamOn(i.currentUrl,"isSantaEditor")){m=a.assign(m,{componentViewMode:"editor"})}if(b.urlUtils.isQueryParamOn(i.currentUrl,"isExternalPreview")){m=a.assign(m,{isSocialInteractionAllowed:false})}i.renderFlags=a.assign({},i.renderFlags,m);var n=new b.SiteData(i);try{if(l&&a.isUndefined(window.karmaIntegration)&&window.parent.FS){b.integrations.fullStory.start()}}catch(a){}var o=c.SiteDataAPI.createSiteDataAPIAndDal(n,e);var p=o.siteData;var q=o.siteDataAPI;var r={pointers:o.pointers,displayedDAL:o.displayedDal,siteDataAPI:q};var s=a.get(window,"sssr.serverSideRender");if(l){o.dataLoadedRegistrar=q.registerDataLoadedCallback.bind(q);window.documentServices=new l.Site(f(l.configs,i.currentUrl),o,a.partial(g,i,s),a.partial(h,d,p,r,j));a.set(window,"testApi.documentServices",window.documentServices)}else{n.pagesData=n.pagesData&&g(i,s,n.pagesData);h(d,p,r,j,k)}}return{clientSide:i,fixPages:g}});