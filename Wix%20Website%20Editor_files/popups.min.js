define("popups/constants/closeButtonsConstants",[],function(){"use strict";return{ICON:"icon",ICON_TYPE:"wysiwyg.viewer.components.PopupCloseIconButton",TEXT:"text",TEXT_TYPE:"wysiwyg.viewer.components.PopupCloseTextButton"}});define("popups/presets/closeButtonsPresets",["lodash","addPanelData","popups/constants/closeButtonsConstants"],function(a,b,c){"use strict";var d={};function e(d){var e=b.getSectionsByComponentType(c.ICON_TYPE,null,d);var f=a.get(e,"0.props.items.0.structure");f.layout=a.omit(f.layout,["x","y"]);return f}function f(a,b){return b.addPanelStyleManager.getComponentThemeStyles(c.TEXT_TYPE,a.theme,a.components)}function g(b,d){var e=d.componentsDefaultData.getComponentDefault(c.TEXT_TYPE);var g=a.first(f(b,d));e.layout=e.panelLayout;e.style=g;delete e.panelLayout;return e}d[c.ICON_TYPE]=e;d[c.TEXT_TYPE]=g;return d});define("popups/actions/closeButtonsActions",["lodash","util","popups/constants/closeButtonsConstants","popups/presets/closeButtonsPresets"],function(a,b,c,d){"use strict";function e(a,b){g(a,c.ICON_TYPE,{y:20,right:20},b)}function f(a,b){g(a,c.TEXT_TYPE,{center:0,bottom:20},b)}function g(a,b,c,e){var f=a.pages.popupPages.getCurrentPopup();var g=a.pages.popupPages.getPopupContainer();var i=a.components.layout.get(g);i.width=Math.min(980,i.width);var j=h(d[b](a,e),i,c);a.components.add(g,j);a.history.add("added close "+b+" button to popup "+f.id)}function h(c,d,e){return a.defaults({layout:b.layoutUtils.convertAnyPositionToLeftTopPosition(a.assign({},c.layout,e),d)},c)}function i(a){k(a,c.ICON_TYPE)}function j(a){k(a,c.TEXT_TYPE)}function k(b,c){var d=b.pages.popupPages.getCurrentPopup();var e=b.components.get.byType(c,d);if(!a.isEmpty(e)){a.forEach(e,function(a){b.components.remove(a)});b.history.add("removed close buttons from popup "+d.id)}}return{addIconButton:e,addTextButton:f,removeIconButton:i,removeTextButton:j}});define("popups/constants/openBehaviorsConstants",[],function(){"use strict";return{DESKTOP:1,MOBILE:2,DESKTOP_AND_MOBILE:3,FLAG_DESKTOP:"openInDesktop",FLAG_MOBILE:"openInMobile",OPEN_DELAY_DEFAULT_VALUE:2,SITE_BEHAVIOR_TYPE:"site",LOAD_ACTION:"load",OPEN_POPUP_BEHAVIOR:"openPopup"}});define("popups/queries/openBehaviorsQueries",["lodash","popups/constants/openBehaviorsConstants"],function(a,b){"use strict";function c(c,d){if(a.isEmpty(c)){return d.behaviors.getDefinition(b.OPEN_POPUP_BEHAVIOR)}return c[0]}function d(a,d){return c(a,d).params[b.FLAG_MOBILE]}function e(a,b){return c(a,b).params.delay}function f(a){var b=a.pages.popupPages.getCurrentPopupId();return a.pages.popupPages.getOpenBehaviorsForPopupWithId(b)}function g(b,c){var d=b.siteSegments.getSiteStructureId();return a.find(c,{pageId:d})}function h(a,b){return!!g(a,b)}function i(b,c,d){var e=g(b,c);if(e){return a.map(d,function(b){return a.defaults({pageId:b},e)})}return c}function j(b,c,d){var e=d.pages.getPageIdList();var f=i(d,b,e);return a(f).reject({popupId:c}).map("pageId").value()}return{isOpenInMobile:d,isMasterPageSelected:h,findMasterPageBehavior:g,getCurrentOpenBehaviors:f,getSomeBehavior:c,getDelay:e,getDenormalizedBehaviors:i,getDisabledPageIds:j}});define("popups/mappers/getInfoForActions",["lodash","popups/queries/openBehaviorsQueries"],function(a,b){"use strict";return function c(d){var e=d.pages.popupPages.getCurrentPopup();var f=d.pages.popupPages.getOpenBehaviorsForPopups();var g=a.filter(f,{popupId:e.id});var h=b.getDisabledPageIds(f,e.id,d);var i=d.pages.getPageIdList();return{allPageIds:i,behaviorDefaults:b.getSomeBehavior(g,d).params,disabledPageIds:a.zipObject(h),enabledPageIds:a.difference(i,h),openBehaviors:g,popupPointer:e,selectedPageIds:a.map(g,"pageId")}}});define("popups/actions/openBehaviorsActions",["core","lodash","popups/mappers/getInfoForActions","popups/queries/openBehaviorsQueries","popups/constants/openBehaviorsConstants"],function(a,b,c,d,e){"use strict";function f(a){return b(a.enabledPageIds).union(a.selectedPageIds).size()}function g(a,b,c){var d=f(b);i(a,{all_pages_selected:c,num_selected_pages:c?d:0,num_unselected_pages:c?0:d})}function h(a,c,d,e){var g=f(c),h=d?b(c.selectedPageIds).push(e).size():b(c.selectedPageIds).pull(e).size();i(a,{all_pages_selected:g===h,num_selected_pages:h,num_unselected_pages:g-h})}function i(b,c){b.bi.event(a.bi.events.popups.POP_UP_SETTINGS_PAGE_SELECTOR_OK,c)}function j(a){var d=c(a);var e=a.pages.getPrimaryPageId();h(a,d,true,e);if(b.has(d.disabledPageIds,e)){return}t(a,d.openBehaviors);r(a,e,d.popupPointer.id,d.behaviorDefaults);a.history.add("assign open behavior only to current page")}function k(a){var b=c(a);t(a,b.openBehaviors);g(a,b,false);a.history.add("remove open behavior from all pages")}function l(a){var e=c(a);var f=e.popupPointer.id;var h=e.openBehaviors;if(d.isMasterPageSelected(a,h)){return}if(b.isEmpty(e.disabledPageIds)){t(a,h);r(a,a.siteSegments.getSiteStructureId(),f,e.behaviorDefaults)}else{b(e.enabledPageIds).difference(e.selectedPageIds).forEach(function(b){r(a,b,f,e.behaviorDefaults)}).value()}g(a,e,true);a.history.add("assign open behavior to all pages")}function m(a,e){var f=c(a);var g=f.popupPointer.id;var i=f.openBehaviors;if(d.isMasterPageSelected(a,i)){return}if(b.has(f.disabledPageIds,e)){return}var j=f.selectedPageIds.concat(e);if(j.length>1&&j.length===f.allPageIds.length){t(a,i);r(a,a.siteSegments.getSiteStructureId(),g,f.behaviorDefaults)}else{r(a,e,g,f.behaviorDefaults)}h(a,f,true,e);a.history.add("assign open behavior to page")}function n(a,b){var e=a.pages.popupPages.getCurrentPopupId();var f=a.pages.popupPages.getOpenBehaviorsForPopupWithId(e);var g=d.findMasterPageBehavior(a,f);var i=c(a);if(g){p(a,g,b)}else{s(a,b,e)}h(a,i,false,b);a.history.add("remove open behavior from page")}function o(a,c){var d=a.pages.popupPages.getCurrentPopupId();var e=a.pages.popupPages.getOpenBehaviorsForPopupWithId(d);e.forEach(function(d){r(a,d.pageId,d.popupId,b.defaults({openInMobile:c},d.params))});a.history.add("toggle load on mobile")}function p(a,c,d){var e=b.without(a.pages.getPageIdList(),d);s(a,a.siteSegments.getSiteStructureId(),c.popupId);e.forEach(function(b){r(a,b,c.popupId,c.params)})}function q(a,c){var d=a.pages.popupPages.getCurrentPopupId();var e=a.pages.popupPages.getOpenBehaviorsForPopupWithId(d);e.forEach(function(d){r(a,d.pageId,d.popupId,b.defaults({delay:c},d.params))})}function r(a,b,c,d){var f=a.components.get.byId(b);var g=a.components.get.byId(c);var h=a.actions.getDefinition(e.LOAD_ACTION);var i=a.behaviors.getDefinition(e.OPEN_POPUP_BEHAVIOR);i.params=d;a.behaviors.update(f,h,g,i)}function s(a,b,c){var d=a.components.get.byId(b);var f=a.components.get.byId(c);var g=a.actions.getDefinition(e.LOAD_ACTION);var h=a.behaviors.getDefinition(e.OPEN_POPUP_BEHAVIOR);a.behaviors.remove(d,g,f,h)}function t(a,c){b.forEach(c,function(b){s(a,b.pageId,b.popupId)})}return{assignOpenBehaviorOnlyToCurrentPage:j,removeOpenBehaviorFromAllPages:k,assignOpenBehaviorToAllPages:l,assignOpenBehaviorToPage:m,removeOpenBehaviorFromPage:n,changeOpenDelay:q,toggleLoadOnMobile:o}});define("popups/mappers/getPopupsInfoTitles",["lodash","popups/queries/openBehaviorsQueries"],function(a,b){"use strict";return function c(d,e){var f=a.map(e,"id");var g=d.pages.popupPages.getOpenBehaviorsForPopups();var h=a.partial(function(b,c){return a.get(b,[c,0,"title"],"")},a.groupBy(e,"id"));var i=a(g).groupBy("popupId").mapValues(function(c){if(b.isMasterPageSelected(d,g)){return a.map(f,h)}return a(c).map("pageId").map(h).value()}).value();return{infoTitles:i}}});define("popups/queries/closeButtonsQueries",["lodash","popups/constants/closeButtonsConstants"],function(a,b){"use strict";var c=b;function d(b,c,d){var e=d.components.get.byType(b,c);return!a.isEmpty(e)}function e(a,b){var e={};e[c.ICON]=d(c.ICON_TYPE,a,b);e[c.TEXT]=d(c.TEXT_TYPE,a,b);return{has:e}}return{getCloseButtonsInfo:e}});define("popups/mappers/getDesktopPanelProps",["lodash","popups/queries/closeButtonsQueries","popups/queries/openBehaviorsQueries"],function(a,b,c){"use strict";return function d(e){var f=e.pages.popupPages.getCurrentPopup();var g=e.pages.popupPages.getOpenBehaviorsForPopups();var h=a.filter(g,{popupId:f.id});var i=b.getCloseButtonsInfo(f,e);return{delay:c.getDelay(h,e),hasIconButton:i.has.icon,hasTextButton:i.has.text,isMasterPageSelected:c.isMasterPageSelected(e,h),selectedPageIds:a.map(h,"pageId")}}});define("popups/mappers/getMobilePanelProps",["popups/queries/openBehaviorsQueries"],function(a){"use strict";return function b(c){var d=a.getCurrentOpenBehaviors(c);return{shouldOpenInMobile:a.isOpenInMobile(d,c)}}});define("popups/mappers/getPageSelectorPanelProps",["lodash","popups/queries/openBehaviorsQueries"],function(a,b){"use strict";var c=a.curry(function a(b,c){var d=c[0].popupId;return b.pages.getPageTitle(d)});function d(a,b,c){return a<b&&b<c}return function e(f){var g=f.pages.popupPages.getCurrentPopup();var h=f.pages.getPageIdList();var i=b.getDenormalizedBehaviors(f,f.pages.popupPages.getOpenBehaviorsForPopups(),h);var j=a.filter(i,{popupId:g.id});var k=a.reject(i,{popupId:g.id});var l=a(k).groupBy("pageId").mapValues(c(f)).value();var m=a.difference(h,a.keys(l));var n=a.map(j,"pageId");return{selectAll:{visible:h.length>1,disabled:m.length===0,indeterminate:d(0,j.length,m.length),checked:n.length>0&&n.length===m.length},selectedPageIds:n,occupiedPages:l}}});define("popups",["popups/actions/closeButtonsActions","popups/actions/openBehaviorsActions","popups/mappers/getPopupsInfoTitles","popups/mappers/getDesktopPanelProps","popups/mappers/getMobilePanelProps","popups/mappers/getPageSelectorPanelProps"],function(a,b,c,d,e,f){"use strict";return{actions:{closeButtons:a,openBehaviors:b},mappers:{popupsList:c,desktopPanel:d,mobilePanel:e,pagesSelectorPanel:f}}});