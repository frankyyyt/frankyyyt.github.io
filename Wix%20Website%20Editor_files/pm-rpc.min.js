!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("pmrpc",[],e):"object"==typeof exports?exports.pmrpc=e():t.pmrpc=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.api=void 0;var i=n(1),s=o(i),u=n(7),a=r(u);a["default"].polyfill();var c={set:s.set,sendTo:s.sendTo,get:s.get,sendToWindow:s.sendToWindow};e.api=c},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.sendToWindow=e.get=e.sendTo=e.set=void 0;var i=n(2),s=o(i),u=n(3),a=o(u),c=n(5),f=o(c),l=n(4),d=o(l),p=n(6),h=r(p),v={},m=function(t,e){var n=[],r=e.data.args,o=e.data.call,i=e.data.appId,s=e.data.intent;"invoke"===s&&r&&o?!function(){var s=0;r.forEach(function(t){t.promiseId?s=t.promiseId:n.push(t)});var u=v[i][o];u?s>0?Promise.all([u.apply(void 0,n)]).then(function(e){"frame"===t?a.getTarget(i).postMessage({intent:"response-promise",promiseId:s,args:e},"*"):self.postMessage({intent:"response-promise",promiseId:s,args:e})}):u.apply(void 0,n):console.warn("bad message w/ data: "+JSON.stringify(e.data))}():e.data.description&&f.buildAPI(e.data,"frame")},g=function(t,e,n,r){if("response-promise"===r.data.intent)s.getPromiseById(r.data.promiseId).apply(this,r.data.args);else if(r.data.description&&r.data.appId===e){f.buildAPI(r.data,n);var o=f.getAPI();o&&t(o)}else f.clear()},y=function(t){var e=Object.keys(t),n={};return e.forEach(function(t){n[t]={}}),n},_=function(t,e){v[t]=e,d.isWorker()&&(d.get().postMessage({appId:t,description:y(e)}),(0,h["default"])(d.get(),t,"message",m.bind(this,"worker"),!1))},w=function(t,e){var n=v[t];if(n){var r=y(n);a.setTarget(e),e.postMessage({appId:t,description:r},"*"),(0,h["default"])(d.get(),t,"message",m.bind(this,"frame"),!1)}else console.warn("No api to send, please call rpc.set w/ proper API")},b=function(t,e){var n=v[t];n?(e===parent&&(e={contentWindow:parent,src:"*"}),a.setTarget(e.contentWindow),e.contentWindow.postMessage({appId:t,description:y(n)},e.src),(0,h["default"])(d.get(),t,"message",m.bind(this,"frame"),!1)):console.warn("No api to send, please call rpc.set w/ proper API")},I=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return d.isWorker()?new Promise(function(e){(0,h["default"])(d.get(),t.appId,"message",g.bind(void 0,e,t.appId,"worker"),!1)}):(a.setTargetId(t.targetId),a.addInitiator(t.appId,t.initiator),new Promise(function(e){(0,h["default"])(d.get(),t.appId,"message",g.bind(void 0,e,t.appId,"frame"),!1)}))};e.set=_,e.sendTo=b,e.get=I,e.sendToWindow=w},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=1,r={},o=function(){return n++},i=function(t,e){r[t]=e},s=function(t){return r[t]};e.getNextPromiseId=o,e.setPromiseById=i,e.getPromiseById=s},function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.addInitiator=e.setTargetId=e.setTarget=e.getTarget=void 0;var o=n(4),i=r(o),s=void 0,u=void 0,a=new Map,c=function(t){var e=d(t);return s&&!e?s:i.isWorker()&&u?i.getContentWindow(u):a.size>0?i.getContentWindow(e):"parent"===u?parent:void 0},f=function(t){s=t},l=function(t,e){a.set(t,e)},d=function(t){return a.get(t)},p=function(t){u=t};e.getTarget=c,e.setTarget=f,e.setTargetId=p,e.addInitiator=l},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){return r()?self:window},r=function(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope},o=function(t){return document.getElementById(t).contentWindow};e.get=n,e.isWorker=r,e.getContentWindow=o},function(t,e,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.clear=e.getAPI=e.buildAPI=void 0;var o=n(2),i=r(o),s=n(3),u=r(s),a=n(4),c=r(a),f={},l=function(t,e){var n={};if(!t.description)return void p();var r=Object.keys(t.description);r.forEach(function(r){n[r]=function(){var n=arguments;return new Promise(function(o){var s=[].concat(Array.prototype.slice.call(n)),a=i.getNextPromiseId();s.push({promiseId:a}),i.setPromiseById(a,o),"frame"===e?u.getTarget(t.appId).postMessage({appId:t.appId,call:r,args:s,intent:"invoke"},"*"):c.get().postMessage({appId:t.appId,call:r,args:s,intent:"invoke"})})}}),f=n},d=function(){return f},p=function(){f=void 0};e.buildAPI=l,e.getAPI=d,e.clear=p},function(t,e){"use strict";function n(t,e,n,i,s){r(e),t.addEventListener(n,i,s),o.push({element:t,scope:e,event:n,handler:i,capture:s})}function r(t){_.map(o,function(e){e.scope===t&&e.element.removeEventListener(e.event,e.handler,e.capture)}),o=[]}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=n;var o=[]},function(t,e,n){var r;(function(t,o,i){(function(){"use strict";function s(t){return"function"==typeof t||"object"==typeof t&&null!==t}function u(t){return"function"==typeof t}function a(t){V=t}function c(t){tt=t}function f(){return function(){t.nextTick(v)}}function l(){return function(){R(v)}}function d(){var t=0,e=new rt(v),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function p(){var t=new MessageChannel;return t.port1.onmessage=v,function(){t.port2.postMessage(0)}}function h(){return function(){setTimeout(v,1)}}function v(){for(var t=0;t<$;t+=2){var e=st[t],n=st[t+1];e(n),st[t]=void 0,st[t+1]=void 0}$=0}function m(){try{var t=n(10);return R=t.runOnLoop||t.runOnContext,l()}catch(e){return h()}}function g(t,e){var n=this,r=new this.constructor(_);void 0===r[ct]&&Y(r);var o=n._state;if(o){var i=arguments[o-1];tt(function(){L(o,r,i,n._result)})}else k(n,r,t,e);return r}function y(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(_);return j(n,t),n}function _(){}function w(){return new TypeError("You cannot resolve a promise with itself")}function b(){return new TypeError("A promises callback cannot return that same promise.")}function I(t){try{return t.then}catch(e){return pt.error=e,pt}}function T(t,e,n,r){try{t.call(e,n,r)}catch(o){return o}}function P(t,e,n){tt(function(t){var r=!1,o=T(n,e,function(n){r||(r=!0,e!==n?j(t,n):x(t,n))},function(e){r||(r=!0,E(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,E(t,o))},t)}function A(t,e){e._state===lt?x(t,e._result):e._state===dt?E(t,e._result):k(e,void 0,function(e){j(t,e)},function(e){E(t,e)})}function M(t,e,n){e.constructor===t.constructor&&n===ut&&constructor.resolve===at?A(t,e):n===pt?E(t,pt.error):void 0===n?x(t,e):u(n)?P(t,e,n):x(t,e)}function j(t,e){t===e?E(t,w()):s(e)?M(t,e,I(e)):x(t,e)}function O(t){t._onerror&&t._onerror(t._result),W(t)}function x(t,e){t._state===ft&&(t._result=e,t._state=lt,0!==t._subscribers.length&&tt(W,t))}function E(t,e){t._state===ft&&(t._state=dt,t._result=e,tt(O,t))}function k(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+lt]=n,o[i+dt]=r,0===i&&t._state&&tt(W,t)}function W(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r,o,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?L(n,r,o,i):o(i);t._subscribers.length=0}}function S(){this.error=null}function C(t,e){try{return t(e)}catch(n){return ht.error=n,ht}}function L(t,e,n,r){var o,i,s,a,c=u(n);if(c){if(o=C(n,r),o===ht?(a=!0,i=o.error,o=null):s=!0,e===o)return void E(e,b())}else o=r,s=!0;e._state!==ft||(c&&s?j(e,o):a?E(e,i):t===lt?x(e,o):t===dt&&E(e,o))}function N(t,e){try{e(function(e){j(t,e)},function(e){E(t,e)})}catch(n){E(t,n)}}function B(){return vt++}function Y(t){t[ct]=vt++,t._state=void 0,t._result=void 0,t._subscribers=[]}function F(t){return new wt(this,t).promise}function G(t){var e=this;return new e(Z(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function z(t){var e=this,n=new e(_);return E(n,t),n}function D(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function J(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function K(t){this[ct]=B(),this._result=this._state=void 0,this._subscribers=[],_!==t&&("function"!=typeof t&&D(),this instanceof K?N(this,t):J())}function U(t,e){this._instanceConstructor=t,this.promise=new t(_),this.promise[ct]||Y(this.promise),Z(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):E(this.promise,q())}function q(){return new Error("Array Methods must be provided an Array")}function H(){var t;if("undefined"!=typeof o)t=o;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=t.Promise;n&&"[object Promise]"===Object.prototype.toString.call(n.resolve())&&!n.cast||(t.Promise=_t)}var Q;Q=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var R,V,X,Z=Q,$=0,tt=function(t,e){st[$]=t,st[$+1]=e,$+=2,2===$&&(V?V(v):X())},et="undefined"!=typeof window?window:void 0,nt=et||{},rt=nt.MutationObserver||nt.WebKitMutationObserver,ot="undefined"==typeof self&&"undefined"!=typeof t&&"[object process]"==={}.toString.call(t),it="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,st=new Array(1e3);X=ot?f():rt?d():it?p():void 0===et?m():h();var ut=g,at=y,ct=Math.random().toString(36).substring(16),ft=void 0,lt=1,dt=2,pt=new S,ht=new S,vt=0,mt=F,gt=G,yt=z,_t=K;K.all=mt,K.race=gt,K.resolve=at,K.reject=yt,K._setScheduler=a,K._setAsap=c,K._asap=tt,K.prototype={constructor:K,then:ut,"catch":function(t){return this.then(null,t)}};var wt=U;U.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===ft&&n<t;n++)this._eachEntry(e[n],n)},U.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===at){var o=I(t);if(o===ut&&t._state!==ft)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===_t){var i=new n(_);M(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){e(t)}),e)}else this._willSettleAt(r(t),e)},U.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===ft&&(this._remaining--,t===dt?E(r,n):this._result[e]=n),0===this._remaining&&x(r,this._result)},U.prototype._willSettleAt=function(t,e){var n=this;k(t,void 0,function(t){n._settledAt(lt,e,t)},function(t){n._settledAt(dt,e,t)})};var bt=H,It={Promise:_t,polyfill:bt};n(11).amd?(r=function(){return It}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):"undefined"!=typeof i&&i.exports?i.exports=It:"undefined"!=typeof this&&(this.ES6Promise=It),bt()}).call(this)}).call(e,n(8),function(){return this}(),n(9)(t))},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(f===setTimeout)return setTimeout(t,0);if((f===n||!f)&&setTimeout)return f=setTimeout,setTimeout(t,0);try{return f(t,0)}catch(e){try{return f.call(null,t,0)}catch(e){return f.call(this,t,0)}}}function i(t){if(l===clearTimeout)return clearTimeout(t);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}function s(){v&&p&&(v=!1,p.length?h=p.concat(h):m=-1,h.length&&u())}function u(){if(!v){var t=o(s);v=!0;for(var e=h.length;e;){for(p=h,h=[];++m<e;)p&&p[m].run();m=-1,e=h.length}p=null,v=!1,i(t)}}function a(t,e){this.fun=t,this.array=e}function c(){}var f,l,d=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:n}catch(t){f=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(t){l=r}}();var p,h=[],v=!1,m=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];h.push(new a(t,e)),1!==h.length||v||o(u)},a.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}}])});