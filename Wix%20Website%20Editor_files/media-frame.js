(function(){"use strict";var getLog,isDebugEnabled,slice=[].slice;isDebugEnabled=function(){var error,ref,ref1;try{return window.DEBUG||(null!=(ref=window.parent)?ref.DEBUG:void 0)||(null!=(ref1=window.top)?ref1.DEBUG:void 0)}catch(error1){return error=error1,window.DEBUG}},getLog=function(){var error,ref,ref1;try{return(null!=(ref=window.top)&&null!=(ref1=ref.Logger)?ref1._log:void 0)||Logger._log}catch(error1){return error=error1,Logger._log}},this.Logger=function(){function Logger(_serviceName){this._serviceName=_serviceName}return Logger.prototype._serviceName="",Logger.prototype._pushLog=function(args,type){return null==type&&(type="log"),getLog().push({type:type,serviceName:this._serviceName,args:args})},Logger.prototype.log=function(){var args;if(args=1<=arguments.length?slice.call(arguments,0):[],this._pushLog(arguments,"log"),isDebugEnabled())return console.log.apply(console,[this._serviceName].concat(slice.call(args)))},Logger.prototype.warn=function(){var args;if(args=1<=arguments.length?slice.call(arguments,0):[],this._pushLog(arguments,"warn"),isDebugEnabled())return console.warn.apply(console,[this._serviceName].concat(slice.call(args)))},Logger.prototype.error=function(){var args;if(args=1<=arguments.length?slice.call(arguments,0):[],this._pushLog(arguments,"error"),isDebugEnabled())return console.error.apply(console,[this._serviceName].concat(slice.call(args)))},Logger}(),this.Logger._log=[],window.addEventListener("keydown",function(event){var keyCode;if(!isDebugEnabled())return keyCode=event.keyCode||event.which,76===keyCode&&event.shiftKey&&event.altKey&&(event.metaKey||event.ctrlKey)?(window.DEBUG=!0,_.forEach(getLog(),function(data){var args;return args=Array.prototype.slice.apply(data.args||[]),args.unshift(data.serviceName),console[data.type].apply(console,args)})):void 0})}).call(this),function(){"use strict";this.MediaFrame=function(){var appReady,connection,createIframe,deferredHandlers,deferredSettings,displayOnReady,getMediaGalleryBaseHost,iframe,isLongUrl,logger,mediaFrame,onReady,subscribeLoader,unSubscribeLoader,wrapper;return iframe=null,connection=null,mediaFrame=null,appReady=!1,displayOnReady=!0,deferredHandlers={on:[],one:[]},deferredSettings=null,logger=new Logger("frameOpener"),isLongUrl=function(url){return url.length>=2048&&/MSIE|Trident/i.test(navigator.userAgent)||url.length>=15612&&/Firefox|Safari/i.test(navigator.userAgent)||url.length>=102400},getMediaGalleryBaseHost=function(){var script;return script=[].filter.call(document.querySelectorAll("script"),function(arg){var src;return src=arg.src,/media-gallery-g5\/.*\/scripts\/media-frame\.js/i.test(src)})[0],script?script.src.replace(/scripts\/media-frame\.js/i,""):""},createIframe=function(settings){var baseUrl,fullUrl,mediaGalleryBaseHost;return mediaGalleryBaseHost=settings.mediaGalleryBaseHost||getMediaGalleryBaseHost(),mediaGalleryBaseHost&&"/"!==mediaGalleryBaseHost.slice(-1)&&(mediaGalleryBaseHost+="/"),appReady=!1,baseUrl=/open\.wixmp\.com/i.test(settings.baseHost)?mediaGalleryBaseHost+"index-open.html#":mediaGalleryBaseHost+"index.html#",fullUrl=baseUrl+"/init/"+encodeURIComponent(JSON.stringify(settings)),iframe=document.createElement("iframe"),iframe.id="mediaGalleryFrame",iframe.style.border="none",iframe.style.display="none",isLongUrl(fullUrl)?(iframe.src=baseUrl,deferredSettings=settings):iframe.src=fullUrl,document.querySelector(settings.appendTo||"body").appendChild(iframe),logger.log("iFrame created",iframe),connection=new WindowMessenger(iframe.contentWindow)},unSubscribeLoader=function(name){return connection.off("adapter."+name)},subscribeLoader=function(loader,name){return connection.on("adapter."+name,function(request){return"function"==typeof loader?loader.apply(null,request.arguments).then(function(response){return response.requestId=request.requestId,connection.emit("adapter."+name+".resolve",response)},function(error){return error.requestId=request.requestId,connection.emit("adapter."+name+".reject",error)}):(loader.requestId=request.requestId,connection.emit("adapter."+name+".resolve",loader))})},onReady=function(){if(appReady=!0,displayOnReady&&(logger.log("onAppReady display iframe"),iframe.style.display="block"),deferredSettings)return logger.log("onAppReady have deferred settings, sending to app",deferredSettings),connection.emit("settings",deferredSettings),deferredSettings=null},wrapper={onClose:function(fn){return console.warn("please use .on('close', fn) method instead of .onClose(fn)"),wrapper.on("close",fn)},onItems:function(fn){return console.warn("please use .on('items', fn) method instead of .onItems(fn)"),wrapper.on("items",fn)},onNotAuthorized:function(fn){return console.warn("please use .on('notauthorized', fn) method instead of .onNotAuthorized(fn)"),wrapper.on("notauthorized",fn)}},["on","one","off"].forEach(function(method){wrapper[method]=function(){return connection[method].apply(null,arguments),wrapper}}),mediaFrame={off:function(event,fn){return connection?wrapper.off.apply(null,arguments):Object.keys(deferredHandlers).forEach(function(method){var handlers,i,j,ref;for(handlers=deferredHandlers[method],i=j=ref=handlers.length-1;j>=0;i=j+=-1)handlers[i][0]!==event||handlers[i][1]!==fn&&"undefined"!=typeof fn||handlers.splice(i,1)}),mediaFrame},open:function(settings){var foldersList,itemsList;return null==settings&&(settings={}),logger.log("open vs settings",settings),foldersList=void 0,itemsList=void 0,connection?appReady?(iframe.style.display="block",connection.emit("settings",settings)):(logger.log("iframe exist but app is not ready. settings deferred"),displayOnReady=!0,deferredSettings=settings):(createIframe(settings),Object.keys(deferredHandlers).forEach(function(method){var args,j,len,ref;for(ref=deferredHandlers[method],j=0,len=ref.length;j<len;j++)args=ref[j],wrapper[method].apply(null,args)}),"empty"!==settings.path&&(displayOnReady=!0),wrapper.on("ready",onReady),wrapper.on("close",mediaFrame.close),wrapper.on("items",mediaFrame.close)),unSubscribeLoader("foldersList"),unSubscribeLoader("itemsList"),iframe.contentWindow.focus(),wrapper},warmup:function(settings){var clonedSettings;return settings=settings||{},clonedSettings={},Object.keys(settings).forEach(function(key){return clonedSettings[key]=settings[key]}),clonedSettings.path="empty",connection?logger.log("frame exist. nothing to do in warmup"):(displayOnReady=!1,mediaFrame.open(clonedSettings)),wrapper},show:function(){return iframe&&(iframe.style.display="block",logger.log("iFrame is visible",iframe)),wrapper},close:function(){return iframe&&(iframe.style.display="none",connection.emit("empty"),logger.log("iFrame is hidden",iframe)),wrapper},kill:function(){console.warn("please use .close() method instead"),iframe&&(iframe.parentNode.removeChild(iframe),iframe=null,connection=null,logger.log("iFrame killed"))},empty:function(){return connection&&connection.emit("empty"),wrapper}},Object.keys(deferredHandlers).forEach(function(method){mediaFrame[method]=function(){return connection?wrapper[method].apply(null,arguments):deferredHandlers[method].push(arguments),mediaFrame}}),mediaFrame}()}.call(this),function(){"use strict";var logger,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};logger=new Logger("WindowMessenger"),this.WindowMessenger=function(){function WindowMessenger(targetWindow){if(this.targetWindow=targetWindow,this._eventHandler=bind(this._eventHandler,this),this.emit=bind(this.emit,this),this.off=bind(this.off,this),this.one=bind(this.one,this),this.on=bind(this.on,this),void 0===this.targetWindow)throw new Error("target window should be defined");this.observers=[],window.addEventListener("message",this._eventHandler,!1)}return WindowMessenger.prototype.on=function(event,fn){return this.observers.push({event:event,fn:fn})},WindowMessenger.prototype.one=function(event,fn){return this.observers.push({event:event,fn:fn,once:!0})},WindowMessenger.prototype.off=function(event,fn){var i,j,ref;for(i=j=ref=this.observers.length-1;j>=0;i=j+=-1)this.observers[i].event!==event||this.observers[i].fn!==fn&&"undefined"!=typeof fn||this.observers.splice(i,1)},WindowMessenger.prototype.emit=function(event,data){return logger.log("postMessage emitted",event,data),this.targetWindow.postMessage(JSON.stringify({event:event,data:data}),"*")},WindowMessenger.prototype._eventHandler=function(event){var data;if(event.source===this.targetWindow)return data=JSON.parse(event.data),logger.log("postMessage received",data),this.observers.filter(function(observer){return observer.event===data.event}).forEach(function(_this){return function(observer){if(observer.fn.call(event,data.data),observer.once)return _this.off(observer.event,observer.fn)}}(this))},WindowMessenger}()}.call(this);