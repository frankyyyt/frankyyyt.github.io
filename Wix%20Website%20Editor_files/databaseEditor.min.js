define("databaseEditor/mixins/dbEditorApiContextMixin",["react"],function(a){"use strict";return{contextTypes:{dbEditorApi:a.PropTypes.object.isRequired},getDbEditorApi:function(){return this.context.dbEditorApi}}});define("databaseEditor/components/itemDetails.rt",["react","lodash","baseUI"],function(a,b,c){"use strict";function d(){var d=this.getImageDef();return a.createElement("span",{key:"item-img-container",className:b({"item-thumb-img":true,noImage:!d.imageValid}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" ")},d.imageValid?a.createElement("img",b.assign({},{key:"item-img-thumb"},d.props)):null,!d.imageValid?a.createElement(c.symbol,{name:"camera",key:"item-img-symbol"}):null)}return function(){return a.createElement("div",{className:"item-details",onClick:this.editItem},this.props.showImage&&this.getImageDef().imageVisible?d.apply(this,[]):null,a.createElement("span",{className:"item-title"},b.unescape(this.props.item.title)||"(Untitled Item)"))}});define("databaseEditor/components/itemDetails",["lodash","react","util","databaseEditor/mixins/dbEditorApiContextMixin","databaseEditor/components/itemDetails.rt"],function(a,b,c,d,e){"use strict";function f(b,c){return a.find(b,function(b,d){return b._type==="wix:Image"&&a.includes(c,d)})}function g(a,b){var d={uri:a.src,width:a.width,height:a.height};var e=c.imageTransform.getData(c.imageTransform.fittingTypes.SCALE_TO_FILL,{width:d.width,height:d.height,id:d.uri},{width:43,height:43,alignment:c.imageTransform.alignTypes.CENTER,htmlTag:"img"});return{src:b.getServiceTopology().staticMediaUrl+"/"+e.uri,style:e.css.img}}return b.createClass({displayName:"itemDetails",mixins:[c.translationMixin,d],propTypes:{item:b.PropTypes.object.isRequired,showImage:b.PropTypes.bool,visibleFields:b.PropTypes.arrayOf(b.PropTypes.string)},getDefaultProps:function(){return{showImage:true}},getImageDef:function(){var b=f(this.props.item,this.props.visibleFields);var c=!!b;var d=c&&!a.isEmpty(b.src);var e=d?g(b,this.getDbEditorApi()):null;return{imageVisible:c,imageValid:d,props:e}},editItem:function(){this.getDbEditorApi().setCurrentItem(this.props.item._iid,"hover_item")},render:e})});define("databaseEditor/components/itemActionMenu.rt",["react","lodash","baseUI","experiment"],function(a,b,c,d){"use strict";function e(a){a.stopPropagation()}return function(){return a.createElement("div",{className:"item-action-menu",onClick:e.bind(this)},a.createElement("div",{className:"action-buttons-container"},a.createElement(c.button,{className:"duplicate-item-button",label:"list_dbe_hover_item_duplicate_tooltip",icon:"duplicate",onClick:this.duplicateItem}),a.createElement(c.button,{className:"delete-item-button",label:"list_dbe_hover_item_delete_tooltip",icon:"delete",onClick:this.deleteItem}),this.props.isHidden?a.createElement(c.button,{key:"hoverItemShowBtn",className:"show-item-button",label:"list_dbe_hover_item_show",icon:"quickActionsShow",onClick:this.showItem}):null,!this.props.isHidden?a.createElement(c.button,{key:"hoverItemHideBtn",className:"hide-item-button",label:"list_dbe_hover_item_hide",icon:"quickActionsHide",onClick:this.hideItem}):null,a.createElement(c.button,{className:"edit-item-button",label:"list_dbe_hover_item_edit",icon:"pencil",onClick:this.editItem})))}});define("databaseEditor/components/itemActionMenu",["react","util","databaseEditor/components/itemActionMenu.rt","databaseEditor/mixins/dbEditorApiContextMixin"],function(a,b,c,d){"use strict";return a.createClass({displayName:"itemActionMenu",mixins:[b.translationMixin,d],propTypes:{item:a.PropTypes.object.isRequired,isHidden:a.PropTypes.bool.isRequired},editItem:function(){var a=this.props.item._iid;var b=this.getDbEditorApi();b.setCurrentItem(a,"hover_item")},duplicateItem:function(){this.getDbEditorApi().duplicateItems([this.props.item],"hover_item")},deleteItem:function(){this.getDbEditorApi().deleteItems([this.props.item],"hover_item")},showItem:function(){this.getDbEditorApi().showItems([this.props.item],"hover_item")},hideItem:function(){this.getDbEditorApi().hideItems([this.props.item],"hover_item")},render:c})});define("databaseEditor/components/itemListRow.rt",["react","lodash","baseUI","databaseEditor/components/itemDetails","databaseEditor/components/itemActionMenu"],function(a,b,c,d,e){"use strict";function f(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}return function(){return a.createElement("div",f({className:"item-list-row"},this.filteredProps()),!this.props.isOpened?a.createElement("span",{className:"drag-handle-container",key:"drag-handle",onMouseDown:this.props.onStartDrag},a.createElement(c.symbol,{name:"dragHandle",className:"symbol-dragHandle"})):null,!this.props.isOpened?a.createElement(c.toggle,{name:"checkbox",labelAfterSymbol:true,key:"item-checkbox",className:"item-selection",value:this.props.isSelected,onChange:this.props.onSelect}):null,a.createElement(d,{className:b({draggable:true}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" "),item:this.props.item,showImage:!this.props.isOpened,visibleFields:this.props.visibleFields,isHidden:this.props.isHidden}),a.createElement(e,{item:this.props.item,isHidden:this.props.isHidden}))}});define("databaseEditor/components/itemListRow",["react","lodash","databaseEditor/components/itemListRow.rt","util"],function(a,b,c,d){"use strict";return a.createClass({displayName:"itemListRow",mixins:[d.propTypesFilterMixin],propTypes:{item:a.PropTypes.object.isRequired,isOpened:a.PropTypes.bool.isRequired,isSelected:a.PropTypes.bool.isRequired,visibleFields:a.PropTypes.arrayOf(a.PropTypes.string),onSelect:a.PropTypes.func.isRequired,onStartDrag:a.PropTypes.func},render:c})});define("databaseEditor/components/noItems.rt",["react","lodash","baseUI"],function(a,b,c){"use strict";return function(){return a.createElement("div",{className:"no-items"},a.createElement(c.symbol,{name:"createYourFirstItem",className:"no-items-image"}),a.createElement("span",{className:"no-items-title"},this.translateIfNeeded("list_dbe_this_list_is_empty")),a.createElement("div",{className:"no-items-click-container"},a.createElement("span",{},this.translateIfNeeded("list_dbe_empty_sate_line2"))))}});define("databaseEditor/components/noItems",["react","lodash","databaseEditor/components/noItems.rt","databaseEditor/mixins/dbEditorApiContextMixin","util"],function(a,b,c,d,e){"use strict";return a.createClass({displayName:"noItems",mixins:[d,e.translationMixin],render:c})});define("databaseEditor/components/itemListFilter/itemListFilter.rt",["react","lodash","baseUI","symbols"],function(a,b,c,d){"use strict";return function(){return a.createElement("span",{className:b({"item-list-filter":true,"is-open":this.state.isBubbleOpen}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" ")},a.createElement("span",{},this.translateIfNeeded("list_dbe_items_filter_label")," "),a.createElement("span",{className:"item-list-filter-value-label",ref:"handler",onClick:this.toggleBubble},"\n        ",this.getValueLabel(),"\n        ",a.createElement(d.symbol,{name:"arrowDown"})),this.state.isBubbleOpen?a.createElement(c.bubble,{key:"itemFilterBubble",value:this.getBubbleContent(),closeTriggers:[c.uiConstants.TOOLTIP.TRIGGERS.CLICK,c.uiConstants.TOOLTIP.TRIGGERS.OUTER_CLICK],alignment:c.uiConstants.TOOLTIP.ALIGNMENT.BOTTOM,styleType:c.uiConstants.TOOLTIP.STYLE_TYPE.CONTENT_ONLY,hideMethod:this.closeBubble,targetNode:this.refs.handler}):null)}});define("databaseEditor/components/itemListFilter/itemListFilterBubble.rt",["react","lodash","symbols"],function(a,b,c){"use strict";function d(a,b){this.props.onChange(a.value)}function e(e,f){return a.createElement("div",{key:e.value,onClick:d.bind(this,e,f),className:b({"item-list-filter-bubble-option":true,selected:this.props.value===e.value}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" ")},a.createElement(c.symbol,{name:"check"}),a.createElement("span",{},this.translateIfNeeded(e.label)))}return function(){return a.createElement.apply(this,["div",{className:"item-list-filter-bubble"},b.map(this.props.options,e.bind(this))])}});define("databaseEditor/components/itemListFilter/itemListFilterBubble",["react","lodash","util","databaseEditor/components/itemListFilter/itemListFilterBubble.rt"],function(a,b,c,d){"use strict";return a.createClass({displayName:"itemListFilterBubble",mixins:[c.translationMixin],propTypes:{value:a.PropTypes.any.isRequired,onChange:a.PropTypes.func.isRequired,options:a.PropTypes.arrayOf(a.PropTypes.shape({label:a.PropTypes.string.isRequired,value:a.PropTypes.any.isRequired})).isRequired},render:d})});define("databaseEditor/components/itemListFilter/itemListFilter",["react","lodash","util","databaseEditor/components/itemListFilter/itemListFilter.rt","databaseEditor/components/itemListFilter/itemListFilterBubble"],function(a,b,c,d,e){"use strict";var f={all:"list_dbe_items_filter_all",visible:"list_dbe_items_filter_visible",hidden:"list_dbe_items_filter_hidden"};function g(a){this.props.onChange(a);this.closeBubble()}return a.createClass({displayName:"itemListFilter",mixins:[c.translationMixin],propTypes:{value:a.PropTypes.oneOf(["all","visible","hidden"]).isRequired,onChange:a.PropTypes.func.isRequired},getInitialState:function(){return{isBubbleOpen:false}},getValueLabel:function(){return this.translateIfNeeded(f[this.props.value])},toggleBubble:function(){this.setState({isBubbleOpen:!this.state.isBubbleOpen})},closeBubble:function(){this.setState({isBubbleOpen:false})},getBubbleContent:function(){return a.createElement(e,{value:this.props.value,onChange:g.bind(this),options:b.map(f,function(a,b){return{label:a,value:b}})})},render:d})});define("databaseEditor/components/itemsList.rt",["react","lodash","baseUI","baseUILib","uiAnimations","databaseEditor/components/itemListRow","databaseEditor/components/noItems","databaseEditor/components/itemListFilter/itemListFilter"],function(a,b,c,d,e,f,g,h){"use strict";function i(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}function j(a,b){this.toggleAllItems()}function k(a,b,c,d){this.toggleItem(c._iid)}function l(a,b,c,d,e){!this.props.openedItemId&&this.refs.sortList.startDrag(d,e)}function m(c,d,e,g){return a.createElement(f,{key:e._iid,item:e,className:b({"hidden-item":false,selected:this.isSelected(e._iid),"no-hover":d>0,"is-open":this.props.openedItemId===e._iid}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" "),isHidden:false,isOpened:!!this.props.openedItemId,isSelected:this.isSelected(e._iid),visibleFields:this.props.visibleFields,onSelect:k.bind(this,c,d,e,g),onStartDrag:l.bind(this,c,d,e,g)})}function n(a,b,c,d){this.toggleItem(c._iid)}function o(c,d,e,g){return a.createElement(f,{key:e._iid,item:e,className:b({"hidden-item":true,selected:this.isSelected(e._iid),"no-hover":d>0,"is-open":this.props.openedItemId===e._iid}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" "),isHidden:true,isOpened:!!this.props.openedItemId,isSelected:this.isSelected(e._iid),visibleFields:this.props.visibleFields,onSelect:n.bind(this,c,d,e,g)})}function p(){var f=c.sortByDragList;var k=this.getSelectedIds().length;return a.createElement("div",i({className:"items-list "+(this.props.openedItemId?"small":"")},this.filteredProps()),a.createElement("header",{className:"list-header"},a.createElement("span",{className:"list-header-left-pane"},a.createElement("span",{className:"list-title"},this.props.listName),!this.props.openedItemId?a.createElement(h,{key:"itemListFilter",value:this.state.itemsFilter,onChange:this.setItemsFilter}):null),a.createElement(c.button,{className:"add-item-btn",label:"list_dbe_edit_item_add_item",onClick:this.addItem})),a.createElement("div",{className:this.props.openedItemId?"add-item-container":"select-all-container"},a.createElement("span",{className:"select-all-checkbox"},a.createElement(c.toggle,{name:"checkbox",labelAfterSymbol:true,value:k>0,indeterminate:k>0&&k<this.filteredItems().length,className:"item-selection",label:this.getItemsSelectionLabel(k),shouldTranslate:false,onChange:j.bind(this,f,k)})),this.props.openedItemId?a.createElement(c.button,{key:"list-view-add-btn",label:"list_dbe_edit_item_add_item",className:"small-add-item",onClick:this.addItem}):null,this.getSelectedIds().length>0?a.createElement("span",{key:"multi-select-actions",className:"multi-select-action-menu checked"},a.createElement(c.button,{className:"multi-duplicate",label:"list_dbe_duplicate_Items",icon:"duplicate",onClick:this.duplicateSelectedItems}),a.createElement(c.button,{className:"multi-delete",label:"list_dbe_delete_items",icon:"delete",onClick:this.deleteSelectedItems}),a.createElement(c.button,{className:"multi-show-hide",label:"list_dbe_show_hide_multiple_items",icon:"quickActionsShow",onClick:this.showHideSelectedItems})):null),this.allItems().length===0&&!this.props.loading?a.createElement(g,{key:"no-items"}):null,a.createElement(d.customScroll,{heightRelativeToParent:"calc(100% - 120px)"},a.createElement("div",{className:this.props.openedItemId?"items-container-edit":"items-container"},this.shouldShowVisibleItems()?a.createElement.apply(this,[f,{ref:"sortList",key:"da-list",className:b({"sort-list":!this.props.openedItemId,"item-edit-sort-list":this.props.openedItemId,"visible-items-container":true}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" "),onItemMoved:this.getDbEditorApi().moveItem,childrenTransition:e.contentAddRemove},b.map(this.props.items,m.bind(this,f,k))]):null,this.shouldShowHiddenItems()?a.createElement.apply(this,["span",{className:"hidden-items-container",key:"hidden-items-container"},b.map(this.props.hiddenItems,o.bind(this,f,k))]):null)))}return function(){return p.apply(this,[])}});define("databaseEditor/components/itemsList",["react","lodash","util","databaseEditor/components/itemsList.rt","databaseEditor/mixins/dbEditorApiContextMixin"],function(a,b,c,d,e){"use strict";function f(a){var c=this.getSelectedIds();return b.filter(a,function(a){return b.includes(c,a._iid)})}return a.createClass({displayName:"itemsList",mixins:[e,c.selectionMixin,c.propTypesFilterMixin],propTypes:{items:a.PropTypes.array.isRequired,hiddenItems:a.PropTypes.array.isRequired,openedItemId:a.PropTypes.string,listName:a.PropTypes.string.isRequired,listId:a.PropTypes.string.isRequired,visibleFields:a.PropTypes.arrayOf(a.PropTypes.string)},getDefaultProps:function(){return{openedItemId:undefined}},getInitialState:function(){return{itemsFilter:"all"}},duplicateSelectedItems:function(){this.getDbEditorApi().duplicateItems(f.call(this,this.filteredItems()),"multiple_selection");this.clearSelection()},deleteSelectedItems:function(){this.getDbEditorApi().deleteItems(f.call(this,this.filteredItems()),"multiple_selection",this.clearSelection)},showHideSelectedItems:function(){var a=f.call(this,this.props.items);var b=f.call(this,this.props.hiddenItems);var c=b.length>0?"showItems":"hideItems";this.getDbEditorApi()[c](a.concat(b),"multiple_selection")},addItem:function(){var a=this.props.openedItemId?"item_view":"list_view";this.getDbEditorApi().addItem(a,function(a){this.getDbEditorApi().setCurrentItem(a)}.bind(this));this.clearSelection();if(!b.includes(["all","visible"],this.state.itemsFilter)){this.setState({itemsFilter:"all"})}},setCurrentItem:function(a){var b=this.getDbEditorApi();var c=this.props.openedItemId?"item_view":"list_view";b.setCurrentItem(a,c)},toggleItem:function(a){var b=this.isSelected(a);this.toggle(a);this.getDbEditorApi().bi.itemSelectionToggle(this.props.listId,a,!b)},toggleAllItems:function(){var a=b.pluck(this.filteredItems(),"_iid");var c=!b.isEmpty(this.getSelectedIds());this.toggleAll(a);this.getDbEditorApi().bi.allItemsSelectionToggle(this.props.listId,!c)},getItemsSelectionLabel:function(a){switch(a){case 0:return c.translate("list_dbe_select_all_label");case 1:return c.translate("list_dbe_1_items_selected");default:return c.translate("list_dbe_x_items_selected").replace("<X>",a)}},allItems:function(){return this.props.items.concat(this.props.hiddenItems)},setItemsFilter:function(a){this.setState({itemsFilter:a});this.clearSelection()},filteredItems:function(){switch(this.state.itemsFilter){case"all":return this.allItems();case"visible":return this.props.items;case"hidden":return this.props.hiddenItems;default:return this.props.items}},shouldShowVisibleItems:function(){return this.props.items.length&&b.includes(["all","visible"],this.state.itemsFilter)},shouldShowHiddenItems:function(){return this.props.hiddenItems.length&&b.includes(["all","hidden"],this.state.itemsFilter)},render:d})});define("databaseEditor/components/itemEdit.rt",["react","lodash","baseUI","baseUILib"],function(a,b,c,d){"use strict";function e(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}function f(a){this.getDbEditorApi().setCurrentItem(null)}function g(a){this.getDbEditorApi().deleteItems([a],"edit_item")}function h(a){this.getDbEditorApi().duplicateItems([a],"edit_item")}function i(b,c,d){return a.createElement("div",{className:"item-field",key:c.definition.name},a.createElement(c.component,{ref:d,item:b,fieldDef:c.definition,placeholder:c.placeholder,visibleSections:{PhoneLink:false}}))}function j(){var j=this.props.item;return a.createElement("div",e({className:"item-edit",key:this.props.item._iid},this.filteredProps()),a.createElement("div",{className:"no-scroll-container"},a.createElement("header",{className:"item-header"},a.createElement("div",{className:"button-container"},a.createElement(c.button,{className:"close-item-btn",icon:"arrowRight",label:"list_dbe_edit_item_close_item",onClick:f.bind(this,j)})),a.createElement("span",{className:"action-container"},this.state.saveLabel?a.createElement("div",{className:"save-item-label",key:"save-item-label"},this.translateIfNeeded(this.state.saveLabel)):null,a.createElement(c.tooltip,{value:"list_dbe_hover_item_delete_tooltip"},a.createElement(c.button,{className:"delete-item-btn",icon:"delete",onClick:g.bind(this,j)})),a.createElement(c.tooltip,{value:"list_dbe_hover_item_duplicate_tooltip"},a.createElement(c.button,{className:"duplicate-item-btn",icon:"duplicate",onClick:h.bind(this,j)}))))),a.createElement(d.customScroll,{heightRelativeToParent:"calc(100% - 67px)"},a.createElement.apply(this,["div",{className:"item-fields-container"},b.map(this.getFields(),i.bind(this,j)),a.createElement("div",{className:"unused-fields-text"},this.translateIfNeeded("list_dbe_edit_hiding_unused_fields"))])))}return function(){return j.apply(this,[])}});define("databaseEditor/components/linkTo/linkToField.rt",["react","lodash","panels","util"],function(a,b,c,d){"use strict";function e(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}return function(){return a.createElement(c.commonControls.linkTo,e({className:d.inheritClassName("input-link-to-field"),value:this.getLinkData(),onChange:this.setLinkData,showButton:false,showIcon:true},this.filterProps()))}});define("databaseEditor/components/linkTo/linkToFieldButton.rt",["react","lodash","panels"],function(a,b,c){"use strict";return function(){return a.createElement(c.commonControls.linkToButton,b.assign({},{value:this.getLinkData(),onChange:this.setLinkData},this.filterProps()))}});define("databaseEditor/components/linkTo/linkToField",["react","lodash","databaseEditor/mixins/dbEditorApiContextMixin","databaseEditor/components/linkTo/linkToField.rt","databaseEditor/components/linkTo/linkToFieldButton.rt"],function(a,b,c,d,e){"use strict";return a.createClass({displayName:"linkToField",mixins:[c],propTypes:{item:a.PropTypes.object.isRequired,fieldDef:a.PropTypes.object.isRequired,useLinkButton:a.PropTypes.bool,label:a.PropTypes.string,placeholder:a.PropTypes.string,minCharsForTooltip:a.PropTypes.number,showButton:a.PropTypes.bool,buttonEditLabel:a.PropTypes.string,buttonAddLabel:a.PropTypes.string},getDefaultProps:function(){return{useLinkButton:false}},getLinkData:function a(){return this.props.item.links&&this.props.item.links[this.props.fieldDef.name]},setLinkData:function(a){var b={};b[this.props.fieldDef.name]=a;this.getDbEditorApi().updateItem(this.props.item._type,this.props.item._iid,{links:b})},filterProps:function(){return b.omit(this.props,["pages","anchors","value","onChange","valueLink"])},render:function(){var a=this.props.useLinkButton?e:d;return a.call(this)}})});define("databaseEditor/components/itemFields/textItemField.rt",["react","lodash","baseUI","databaseEditor/components/linkTo/linkToField"],function(a,b,c,d){"use strict";function e(a){this.updateFieldValue(b.escape(a))}function f(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}return function(){return a.createElement("div",{className:"text-item-field"},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),a.createElement("div",{className:"text-input"},a.createElement(c.textInput,{value:b.unescape(this.getFieldValue()),onChange:e.bind(this),maxLength:500,placeholder:this.props.placeholder}),!this.hasLink()?a.createElement(d,b.assign({},{key:"noLink",useLinkButton:true},this.getLinkToFieldProps())):null),this.hasLink()?a.createElement(d,f({className:"input-link-to",key:"hasLink",label:"list_dbe_edit_item_link_label",placeholder:"list_dbe_edit_item_link_placeholder"},this.getLinkToFieldProps())):null)}});define("databaseEditor/mixins/itemFieldMixin",["lodash","react","databaseEditor/mixins/dbEditorApiContextMixin"],function(a,b,c){"use strict";function d(a,b){return(b||[]).reduce(function(a,b){return a&&a[b]},a)}function e(a){return a.reduceRight(function(a,b){var c={};c[b]=a;return c})}return{propTypes:{item:b.PropTypes.object.isRequired,fieldDef:b.PropTypes.object.isRequired},mixins:[c],getFieldDisplayName:function(){return this.props.fieldDef.displayName||this.props.fieldDef.name},getFieldValue:function(a,b){var c=b||this.props;var e=c.item[c.fieldDef.name];if(a){e=d(e,a)}return e},updateFieldValue:function(a,b){var c=[this.props.fieldDef.name].concat(b||[]).concat(a);var d=e(c);this.getDbEditorApi().updateItem(this.props.item._type,this.props.item._iid,d)},linkedFieldValue:function(a){var b=this;return{value:this.getFieldValue(a),requestChange:function(c){b.updateFieldValue(c,a)}}},hasLink:function(){return this.props.item.links&&!!this.props.item.links[this.props.fieldDef.name]},getLinkToFieldProps:function(){return a.pick(this.props,["item","fieldDef","visibleSections"])}}});define("databaseEditor/components/itemFields/textItemField",["react","lodash","databaseEditor/components/itemFields/textItemField.rt","databaseEditor/mixins/itemFieldMixin"],function(a,b,c,d){"use strict";return a.createClass({displayName:"textItemField",mixins:[d],render:c})});define("databaseEditor/components/itemFields/buttonItemField.rt",["react","lodash","baseUI","databaseEditor/components/linkTo/linkToField"],function(a,b,c,d){"use strict";return function(){return a.createElement("div",{className:"text-item-field"},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),a.createElement("div",{className:"text-input"},a.createElement(c.textInput,{valueLink:this.linkedFieldValue(),placeholder:"list_dbe_button_placeholder",maxLength:100})),a.createElement(d,b.assign({},{label:"list_dbe_edit_item_link_label",placeholder:"list_dbe_edit_item_link_placeholder"},this.getLinkToFieldProps()),'\r\n            showIcon="',true,'"\r\n    '))}});define("databaseEditor/components/itemFields/buttonItemField",["react","lodash","databaseEditor/components/itemFields/buttonItemField.rt","databaseEditor/mixins/itemFieldMixin"],function(a,b,c,d){"use strict";return a.createClass({displayName:"buttonItemField",mixins:[d],render:c})});define("databaseEditor/components/itemFields/dateItemField.rt",["react","lodash","baseUI","symbols","util","uiAnimations","databaseEditor/components/linkTo/linkToField"],function(a,b,c,d,e,f,g){"use strict";function h(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}function i(){var i=this.getValueAsDate();return a.createElement("div",{className:"date-item-field"},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),a.createElement("div",{className:"text-input"},a.createElement("div",{className:b({"control-text-input":true,"date-picker-open":this.state.dateBubbleOpen}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" "),onClick:this.toggleDateBubble},a.createElement(d.symbol,{name:"calendar"}),a.createElement("span",{ref:"dateSpan",className:b({disabled:b.isEmpty(this.getFieldValue().iso)}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" ")},i?i.toLocaleDateString():e.translate("list_dbe_date_empty"))),!this.hasLink()?a.createElement(g,b.assign({},{key:"add-link-button",useLinkButton:true},this.getLinkToFieldProps())):null),this.hasLink()?a.createElement(g,h({className:"input-link-to",key:"link-to-field",label:"list_dbe_edit_item_link_label",placeholder:"list_dbe_edit_item_link_placeholder"},this.getLinkToFieldProps())):null,a.createElement(f.tooltipAnimation,{},this.state.dateBubbleOpen?a.createElement(c.bubble,{key:"dateBubble",value:this.getDatePicker(i),width:"301px",closeTriggers:[c.uiConstants.TOOLTIP.TRIGGERS.OUTER_CLICK],alignment:c.uiConstants.TOOLTIP.ALIGNMENT.BOTTOM,styleType:c.uiConstants.TOOLTIP.STYLE_TYPE.CONTENT_ONLY,hideMethod:this.hideDateBubble,targetNode:this.refs.dateSpan,ref:"popup",style:{position:"absolute"}}):null))}return function(){return i.apply(this,[])}});define("databaseEditor/components/itemFields/dateItemField",["react","lodash","baseUI","databaseEditor/mixins/itemFieldMixin","databaseEditor/components/itemFields/dateItemField.rt"],function(a,b,c,d,e){"use strict";var f=["January","February","March","April","May","June","July","August","September","October","November","December"];var g=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];return a.createClass({displayName:"dateItemField",mixins:[d],getInitialState:function(){return{dateBubbleOpen:false}},getDatePicker:function(d){var e={value:d,onChange:this.updateDate,todayLabel:"list_DatePicker_TodayButton_Label",goToSelectedLabel:"list_DatePicker_GoToSelectedButton_Label",monthNames:b.map(f,function(a){return"list_DatePicker_MonthsConstLong_"+a}),days:b.map(g,function(a){return"list_DatePicker_DayConstShort_"+a}),startDay:"list_DatePicker_DayConstShort_Sunday",popOnlyValue:true,showDelete:true};return a.createElement(c.datePicker,e)},getValueAsDate:function(){var a=this.getFieldValue();return a&&a.iso?new Date(a.iso):null},updateDate:function(a){this.updateFieldValue(a?a.toISOString():"","iso");this.toggleDateBubble()},toggleDateBubble:function(){this.setState({dateBubbleOpen:!this.state.dateBubbleOpen})},hideDateBubble:function(){this.setState({dateBubbleOpen:false})},render:e})});define("databaseEditor/components/itemFields/imageItemField.rt",["react","lodash","baseUI","databaseEditor/components/linkTo/linkToField"],function(a,b,c,d){"use strict";function e(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}function f(){var f=this.getFieldValue();return a.createElement("div",{},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),a.createElement("div",{className:"image-item-field"},a.createElement(c.imageChangeRemove,{className:"image-panel",addButtonLabel:"list_dbe_edit_item_image_add_image",changeButtonLabel:"list_dbe_edit_item_change_image",removeButtonLabel:"list_dbe_edit_item_remove_image",onChange:this.onMediaRemoved,mediaManager:this.getDbEditorApi().mediaServices.mediaManager,value:this.getWPhotoData(f)}),a.createElement("div",{className:"text-panel"},a.createElement(c.textInput,{label:"list_dbe_edit_item_alt",placeholder:"list_dbe_edit_item_alt_placeholder",value:f.title,onChange:this.updateTitle,maxLength:100,disabled:b.isEmpty(f.src)}),a.createElement(d,e({className:"input-link-to",label:"list_dbe_edit_item_link_label",placeholder:"list_dbe_edit_item_link_placeholder",disabled:b.isEmpty(f.src),showIcon:true},this.getLinkToFieldProps())))))}return function(){return f.apply(this,[])}});define("databaseEditor/components/itemFields/imageItemField",["react","lodash","databaseEditor/components/itemFields/imageItemField.rt","databaseEditor/mixins/itemFieldMixin"],function(a,b,c,d){"use strict";return a.createClass({displayName:"imageItemField",mixins:[d],updateTitle:function(a){this.updateFieldValue(a,["title"])},getWPhotoData:function(a){return b.assign({type:"Image",uri:a.src},b.pick(a,["title","width","height"]))},onMediaRemoved:function(a){var c={src:"",title:"",height:0,width:0};if(a){b.assign(c,{src:a.uri,title:a.title,height:a.height,width:a.width})}this.updateFieldValue(c)},render:c})});define("databaseEditor/components/itemFields/richTextItemField.rt",["react","lodash","textControls"],function(a,b,c){"use strict";function d(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}return function(){return a.createElement("div",{className:b({"rich-text-item-field":true,editing:this.state.editing}).transform(function(a,b,c){if(b){a.push(c)}},[]).join(" ")},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),a.createElement(c.richTextInput,d({ref:"richTextInput",className:"rich-text-input",onFocus:this.onFocus,onBlur:this.onBlur,hideToolbar:!this.state.editing,isFocusOnInit:false,isFixedHeight:true,openLinkDialog:this.openLinkDialog,openColorPicker:this.openColorPicker,value:this.getValue(),onChange:this.updateValue,panelManager:this.getPanelManager(),nonPasteableLinkTypes:this.getNonPasteableLinkTypes()},this.getRichTextProps())))}});define("databaseEditor/migrations/richTextMigrations",["lodash"],function(a){"use strict";var b=3;var c=/<hatul[^>]*>/gi;var d=/<\/hatul>/gi;function e(a){a=a.replace(c,"");a=a.replace(d,"");return a}function f(c){if(a.get(c,"version",0)>=b){return c}c.text=e(c.text);c.version=b;return c}function g(){return b}return{migrateToCurrentVersion:f,getCurrentVersion:g}});define("databaseEditor/components/itemFields/richTextItemField",["reactDOM","react","lodash","util","databaseEditor/components/itemFields/richTextItemField.rt","databaseEditor/mixins/itemFieldMixin","textControls","databaseEditor/migrations/richTextMigrations","experiment"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){var b;if(typeof MouseEvent==="function"){b=new window.MouseEvent("mousedown",{bubbles:true,button:0})}else{b=window.document.createEvent("MouseEvents");b.initMouseEvent("mousedown",true,true,a,0,0,0,0,0,false,false,false,false,0,null)}a.dispatchEvent(b)}return b.createClass({displayName:"richTextItemField",mixins:[f],getInitialState:function(){return{editing:false}},getRichTextProps:function(){var a=this.getDbEditorApi().getSiteInfo();var b=a.generalInfo.getDocumentType();var d=a.theme.fonts.getCharacterSet();var e={themeColors:a.theme.colors.getAll(),themeFonts:a.theme.fonts.getAll(),documentType:b,languages:d,fonts:g.fontUtils.getCurrentSelectableFontsWithParams(a)
};if(i.isOpen("se_fontsRefactor")){c.merge(e,{fontsUrls:a.fonts.css.getUrls(),themeFontsCss:a.theme.fonts.getThemeStyles(),themeColorsCss:a.theme.colors.getCss()})}return e},getValue:function(){var a=this.getFieldValue();if(this.getDbEditorApi().getCurrentListVersion()==="2.0"){a=h.migrateToCurrentVersion(a)}return{text:a.text,linkList:a.links}},updateValue:function(a){var b={text:a.text,links:a.linkList};if(this.getDbEditorApi().getCurrentListVersion()==="2.0"){b.version=h.getCurrentVersion()}this.updateFieldValue(b)},getPanelManager:function(){return this.getDbEditorApi().panelManager},openLinkDialog:function(a,b){var c=this.getDbEditorApi();var e=d.link.getLinkPanelProps(c.documentServices,{link:a,callback:b,visibleSections:this.props.visibleSections});c.panelManager.openPanel("panels.toolPanels.linkPanel",e)},openColorPicker:function(a,b,c,d){var e=this.getDbEditorApi();var f=e.getSiteInfo();e.panelManager.openPanel("panels.toolPanels.colorPicker.colorPickerPanel",{siteCustomColors:f.theme.colors.getCustomUsedInSkins(),sessionStorage:e.getUserPreferences().session,value:a,onChange:b,isBlockingLayerFullScreen:true,shouldBlockOuterScroll:true,top:c.top,left:c.left,previewOnHover:d},true)},onFocus:function(){j(a.findDOMNode(this));this.refs.richTextInput.showScroll();this.setState({editing:true})},onBlur:function(){this.refs.richTextInput.hideScroll();this.setState({editing:false})},getNonPasteableLinkTypes:function(){return c.pick(d.link.LinkTypes,["PHONE_LINK"])},render:e})});define("databaseEditor/components/itemFields/videoItemField.rt",["react","lodash","baseUI","util"],function(a,b,c,d){"use strict";function e(){var b=this.state.status;return a.createElement("div",{className:"inputs-container "+b},a.createElement(c.videoInput,{valueLink:this.linkedFieldValue(),nonEmptyButtonLabel:"list_dbe_edit_item_search_video",emptyButtonLabel:"list_dbe_edit_item_search_video",panelManager:this.getDbEditorApi().panelManager}),a.createElement("div",{},a.createElement(c.textInput,{ref:"textInput",className:"video-url-input",label:"list_dbe_edit_item_video_url",value:this.state.videoUrl,onChange:this.updateVideoUrl,placeholder:this.props.placeholder}),a.createElement("div",{className:"error-msg-and-button"},a.createElement("span",{},b==="invalid"?d.translate("list_dbe_edit_item_bad_video_url"):""),this.state.videoUrl!==this.getVideoUrl()&&b==="idle"?a.createElement(c.button,{key:"update-button",className:"update-button",label:"list_dbe_edit_item_update_video_url",onClick:this.handleClick}):null,b!=="idle"?a.createElement(c.symbol,{key:"validation-status",name:b==="valid"?"inputValidationSuccess":"inputValidationError"}):null)))}return function(){return a.createElement("div",{className:"video-item-field"},a.createElement("label",{className:"item-field-title"},this.getFieldDisplayName()),e.apply(this,[]))}});define("databaseEditor/components/itemFields/videoItemField",["react","lodash","util","baseUI","databaseEditor/components/itemFields/videoItemField.rt","databaseEditor/mixins/itemFieldMixin"],function(a,b,c,d,e,f){"use strict";function g(){this.success=true;var a={status:"valid"};this.setState(a);if(b.isEmpty(this.state.videoUrl)){this.updateFieldValue({videoId:""})}else{var d=c.videoUtils.getVideoDataFromUrl(this.state.videoUrl);this.updateFieldValue({videoType:d.videoType,videoId:d.videoId})}b.delay(function(){this.success=false;this.setState({status:"idle"})}.bind(this),2e3)}function h(){this.setState({status:"invalid"});this.refs.textInput.focus()}return a.createClass({displayName:"videoItemField",mixins:[f],getInitialState:function(){return{status:"idle",videoUrl:this.getVideoUrl()}},componentWillReceiveProps:function(a){var c=this.getVideoUrl(a);if(!b.isEqual(this.getVideoUrl(),c)){this.updateVideoUrl(c)}},getVideoUrl:function(a){return c.videoUtils.getVideoUrl(this.getFieldValue(null,a))},updateVideoUrl:function(a){this.setState({status:this.success?this.state.status:"idle",videoUrl:a})},handleClick:function(){if(b.isEmpty(this.state.videoUrl)){b.defer(g.bind(this))}else{c.videoUtils.verifyVideoUrl(this.state.videoUrl,g.bind(this),h.bind(this))}},render:e})});define("databaseEditor/components/itemEdit",["react","lodash","util","databaseEditor/components/itemEdit.rt","databaseEditor/mixins/dbEditorApiContextMixin","databaseEditor/components/itemFields/textItemField","databaseEditor/components/itemFields/buttonItemField","databaseEditor/components/itemFields/dateItemField","databaseEditor/components/itemFields/imageItemField","databaseEditor/components/itemFields/richTextItemField","databaseEditor/components/itemFields/videoItemField"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={string:f,"string|asprice":f,"string|asbutton":g,"wix:image":i,"wix:richtext":j,"wix:video":k,"wix:date":h};var m={Error:"list_dbe_edit_item_status_error",Saving:"list_dbe_edit_item_status_saving",Saved:"list_dbe_edit_item_status_saved",Idle:"list_dbe_edit_item_status_idle",Failed:"list_dbe_edit_item_status_error"};var n={Title:"list_dbe_title_placeholder",Subtitle:"list_dbe_subtitle_placeholder",Description:"list_dbe_description_placeholder",Price:"list_dbe_price_placeholder",Video:"list_dbe_edit_item_video_link_placeholder"};function o(a){var c=a.metadata&&a.metadata.showAsHint;var d=b.compact([a.type,c]).join("|");return l[d.toLowerCase()]}function p(a){return m[a]}function q(a){if(a.item._iid!==this.props.item._iid){this.setState({saveLabel:null})}else{var c=a.saveState!==this.props.saveState;c=c&&!(a.saveState==="Idle"&&b.includes(["Saved","Failed","Error"],this.props.saveState));if(c){this.setState({saveLabel:p(a.saveState)})}}}return a.createClass({displayName:"itemEdit",mixins:[e,c.propTypesFilterMixin,c.blockOuterScrollMixin,c.translationMixin],propTypes:{item:a.PropTypes.object.isRequired,itemSchema:a.PropTypes.object.isRequired,saveState:a.PropTypes.string.isRequired,visibleFields:a.PropTypes.arrayOf(a.PropTypes.string)},getInitialState:function(){return{saveLabel:null}},componentWillReceiveProps:function(a){q.call(this,a)},getFields:function(){var a=this;return b(a.props.itemSchema.fields).filter(function(c){return b.includes(a.props.visibleFields,c.name)||c.name==="title"}).map(function(a){return{component:o(a),definition:a,placeholder:n[a.displayName]||""}}).filter("component").value()},render:d})});define("databaseEditor/dbEditor/dbEditor.rt",["react","lodash","databaseEditor/components/itemsList","databaseEditor/components/itemEdit","uiAnimations"],function(a,b,c,d,e){"use strict";function f(a,c){var d=b.assign({},a,c);if(a.hasOwnProperty("style")){d.style=b.defaults(d.style,a.style)}if(a.hasOwnProperty("className")&&c.hasOwnProperty("className")){d.className=c.className+" "+a.className}return d}return function(){return a.createElement("div",f({className:"db-editor-container",onMouseDown:this.blockMiddleMouseClick},this.getAnimationsEventListeners()),a.createElement(c,{items:this.props.items,hiddenItems:this.props.hiddenItems,openedItemId:this.props.currentItemId,listName:this.props.listName,listId:this.props.currentListId,visibleFields:this.props.visibleFields}),a.createElement(e.dbEditItemSlide,{direction:"right"},this.props.currentItemId?a.createElement(d,{key:"item-edit",item:this.getItem(this.props.currentItemId),itemSchema:this.props.itemSchema,visibleFields:this.props.visibleFields,saveState:this.props.saveState}):null))}});define("databaseEditor/dbEditor/dbEditor",["react","lodash","uiAnimations","databaseEditor/dbEditor/dbEditor.rt"],function(a,b,c,d){"use strict";return a.createClass({displayName:"dbEditor",mixins:[c.animationManager],propTypes:{dbEditorApi:a.PropTypes.object.isRequired,currentListId:a.PropTypes.string,items:a.PropTypes.array,hiddenItems:a.PropTypes.array,currentItemId:a.PropTypes.string,listName:a.PropTypes.string,itemSchema:a.PropTypes.object,saveState:a.PropTypes.string,visibleFields:a.PropTypes.arrayOf(a.PropTypes.string)},childContextTypes:{dbEditorApi:a.PropTypes.object.isRequired,mediaServices:a.PropTypes.object},getDefaultProps:function(){return{items:[]}},componentDidMount:function(){this.props.dbEditorApi.bi.dbEditorOpenSuccess(this.props.currentListId)},getChildContext:function(){return{dbEditorApi:this.props.dbEditorApi,mediaServices:this.props.dbEditorApi.mediaServices}},getItem:function(a){return b.find(this.props.items,{_iid:a})||b.find(this.props.hiddenItems,{_iid:a})},blockMiddleMouseClick:function(a){if(a.button===1){return false}},render:d})});define("databaseEditor/dataService/DataService",["lodash","pLoader!santa:wixappsBuilder"],function(a,b){"use strict";var c=b.builderDataHandler;var d="appbuilder";function e(b){a.forEach(this.updateCallbacks,function(a){a(b)})}function f(){return{type:d,instanceId:this.storeId}}function g(a,b){var d=c.getApplicationRepoRequest(a,f.call(this));if(d===null){return}function g(){h.call(this,a,b);e.call(this)}this.store.loadBatch([d],g.bind(this))}function h(a,b){var d=null;var g=c.getAppPartDataRequest(a,f.call(this),b,d);if(g===null){return}this.store.loadBatch([g],e.bind(this,b))}function i(a,b){this.store=a;this.storeId=b;this.updateCallbacks=[];this.wasRepoRequested=false;this.requestedLists={}}i.prototype={loadListData:function(a){if(this.requestedLists[a]){return}this.requestedLists[a]=true;var b=this.store.getData();if(!this.wasRepoRequested){this.wasRepoRequested=true;g.call(this,b,a)}else{h.call(this,b,a)}},wasRepoLoaded:function(){return b.dataFetchingStateManager.hasPackageLoadedSuccessfully(this.store.getData(),f.call(this))},wasListLoaded:function(a){return b.dataFetchingStateManager.hasPartLoadedSuccessfully(this.store.getData(),f.call(this),a)},wasRepoLoadErroneous:function(){return b.dataFetchingStateManager.isPackageErroneous(this.store.getData(),f.call(this))},wasListLoadErroneous:function(a){return b.dataFetchingStateManager.isPartErroneous(this.store.getData(),f.call(this),a)},registerForUpdates:function(a){this.updateCallbacks.push(a)}};return i});define("databaseEditor/dbEditor/DbEditorApi",["lodash","mediaServices","util","experiment","userPreferences"],function(a,b,c,d){"use strict";var e={idle:"Idle",saved:"Saved",failed:"Failed",saving:"Saving"};function f(a){return"databaseEditor.panels."+a}function g(a){var b=this.dataService.wasRepoLoadErroneous();var c=this.dataService.wasListLoadErroneous(a);if(b||c){this.bi.listLoadFailed(a,!b,!c);this.panelManager.openPanel(f("loadFailedMessagePanel"),{onConfirm:function(){window.location.reload()}})}else{h.call(this)}}function h(){var b=n.call(this);a.forEach(this.stateChangedCallbacks,function(a){a(b)})}function i(){return this.appbuilderServices.data.lists.getItems(this.currentListId)}function j(){return this.appbuilderServices.data.lists.getHiddenItems(this.currentListId)}function k(){return this.appbuilderServices.data.lists.getListName(this.currentListId)}function l(){var b=this.appbuilderServices.layout.getAllFields;var c=a(this.currentListId).thru(b).reject("hidden").map("name").value();var d=a(b(this.currentListId,"Mobile")).reject("hidden").map("name").value();return a.uniq(c.concat(d))}function m(a,b){if(b){setTimeout(m.bind(this,a),b)}else{this.saveState=a;h.call(this)}}function n(){var a=this.dataService.wasRepoLoaded();var b=a&&this.dataService.wasListLoaded(this.currentListId);return{currentListId:this.currentListId,items:b?i.call(this):[],hiddenItems:b?j.call(this):[],currentItemId:this.currentItemId,listName:a?k.call(this):null,itemSchema:a?this.appbuilderServices.data.lists.getItemSchema(this.currentListId):null,visibleFields:this.visibleFields,dbEditorApi:this,openPanels:this.panelManager.getOpenPanels(),saveState:this.saveState,loading:!b}}function o(){if(this.disableAutoSave===true){h.call(this);return}if(this.saveState===e.saving){this.savePending=true;return}function a(){m.call(this,e.saved);if(this.savePending){this.savePending=false;o.call(this);return}setTimeout(function(){if(this.saveState!==e.saving){m.call(this,e.idle)}}.bind(this),this.idleTimeout)}function b(){this.savePending=false;m.call(this,e.failed);m.call(this,e.idle,this.idleTimeout);this.panelManager.openPanel(f("saveFailedMessagePanel"))}m.call(this,e.saving);this.appbuilderServices.save(a.bind(this),b.bind(this))}function p(a){var b=Object.create(a);b.openPanel=function b(c,d){a.openPanel(c,d,true)};return b}function q(b,c){return a.filter(b,function(b){return a.find(c,{_iid:b._iid})})}function r(b,d){var e=a.assign({},d,{title:c.translate("list_dbe_prefix_for_duplicated_item")+d.title});return this.appbuilderServices.data.items.create(b,e)}function s(c,f,h,i,j,k,m,o,q,r,s,t){a.bindAll(this);this.disableAutoSave=s;this.idleTimeout=q;this.dataService=c;this.appbuilderServices=h.wixapps.appbuilder;this.documentServices=h;this.siteInfo=i;this.serviceTopology=k;this.stateChangedCallbacks=[];this.currentListId=o;this.currentItemId=null;this.saveState=e.idle;this.savePending=false;this.panelManager=p(m);this.mediaServices=t||new b;this.userPreferences=j;this.bi=f;if(d.isOpen("appBuilderDataMigration")){this.appbuilderServices.migration.migrateList(o)}c.registerForUpdates(g.bind(this));if(r){this.visibleFields=l.call(this);r(n.call(this))}}s.prototype={getServiceTopology:function(){return this.serviceTopology},getUserPreferences:function(){return this.userPreferences},setCurrentList:function(a){this.currentListId=a;this.currentItemId=null;this.dataService.loadListData(a);this.visibleFields=l.call(this);h.call(this)},getPagesData:function(){return this.documentServices.pages.getPagesData()},getSiteMenuItems:function(){return this.documentServices.mainMenu.getMenu()},createDefaultDataItem:function(a){return this.documentServices.data.createItem(a)},setCurrentItem:function(a,b){this.currentItemId=a;h.call(this);if(a&&b){this.bi.itemEdit(b,this.currentListId,a)}},debouncedSave:a.debounce(o,500),broadcastStateChanged:h,moveItem:function(a,b){var c=this.appbuilderServices.data.lists.selection.get(this.currentListId);var d=c.itemIds;var e=d[a];d.splice(b,0,d.splice(a,1)[0]);this.bi.itemMove(this.currentListId,c.id,e);this.appbuilderServices.data.lists.selection.setManual(this.currentListId,d);o.call(this)},addItem:function(b,c){c=c||a.noop;var d=this.appbuilderServices.data.lists.getDatabaseId(this.currentListId);var e=this.appbuilderServices.data.items.create(d);var f=this.appbuilderServices.data.lists.selection.get(this.currentListId);var g=f.itemIds;g.unshift(e);this.bi.itemAdd(b,this.currentListId,f.id,e);this.appbuilderServices.data.lists.selection.setManual(this.currentListId,g);c(e);o.call(this);return e},updateItem:function(a,b,c){this.appbuilderServices.data.items.update(a,b,c);this.debouncedSave();h.call(this)},duplicateItems:function(b,c){var d=a.pluck(b,"_iid");var e=this.appbuilderServices.data.lists.getDatabaseId(this.currentListId);var f=this.appbuilderServices.data.lists.selection.get(this.currentListId);this.bi.itemsDuplicate(c,this.currentListId,f.id,d);a.forEach(q(b,j.call(this)),r.bind(this,e),this);var g=a.map(q(b,i.call(this)),r.bind(this,e),this);var h=f.itemIds;var k=a.findLastIndex(h,function(b){return a.includes(d,b)});h.splice.apply(h,[k+1,0].concat(g));this.appbuilderServices.data.lists.selection.setManual(this.currentListId,h);if(this.currentItemId){this.setCurrentItem(a.last(g))}o.call(this)},deleteItems:function(b,c,d){var e=this;d=d||a.noop;function g(){var f=e.appbuilderServices.data.lists.selection.get(e.currentListId);e.bi.itemsDelete(c,e.currentListId,f.id,a.pluck(b,"_iid"));a.forEach(b,function(b){if(e.currentItemId===b._iid){var c=a.pluck(i.call(e),"_iid");var d=c.indexOf(b._iid);var f=c[d+1]||c[d-1]||null;e.setCurrentItem(f)}e.appbuilderServices.data.items.delete(b._type,b._iid)});d();o.call(e)}this.panelManager.openPanel(f("deleteItemsConfirmationPanel"),{onConfirm:g,onCancel:a.noop})},showItems:function(b){var c=this.appbuilderServices.data.lists.selection.get(this.currentListId);var d=a.pluck(b,"_iid");var e=a.union(c.itemIds,d);this.appbuilderServices.data.lists.selection.setManual(this.currentListId,e);o.call(this)},hideItems:function(b){var c=this.appbuilderServices.data.lists.selection.get(this.currentListId);var d=a.pluck(b,"_iid");var e=a.difference(c.itemIds,d);this.appbuilderServices.data.lists.selection.setManual(this.currentListId,e);o.call(this)},getCurrentListVersion:function(){return this.appbuilderServices.data.lists.getListVersion(this.currentListId)},registerForStateChanged:function(a){this.stateChangedCallbacks.push(a)},getSiteInfo:function(){return this.siteInfo}};return s});define("databaseEditor/panels/deleteItemsConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(a,b,c,d){"use strict";return function(){return a.createElement(c.frames.confirmationPanelFrame,{panelName:this.props.panelName,className:"delete-list-items-confirmation",type:"important",panelTitle:this.translateIfNeeded("list_dbe_delete_are_you_sure_title"),onCancel:this.props.onCancel,onConfirm:this.props.onConfirm,confirmLabel:"list_dbe_delete_are_you_sure_confirm_button",cancelLabel:"list_dbe_delete_are_you_sure_cancel_button"},a.createElement(d.symbol,{name:"garbage-truck-clipart",className:"image"}),a.createElement("div",{className:"text"},a.createElement("span",{},this.translateIfNeeded("list_dbe_delete_items_subtitle")),a.createElement("span",{},this.translateIfNeeded("list_dbe_delete_are_you_sure_text"))))}});define("databaseEditor/panels/deleteItemsConfirmationPanel",["react","util","lodash","databaseEditor/panels/deleteItemsConfirmationPanel.rt"],function(a,b,c,d){"use strict";return a.createClass({displayName:"deleteItems",mixins:[b.translationMixin],render:d})});define("databaseEditor/panels/saveFailedMessagePanel.rt",["react","lodash","panels","baseUI"],function(a,b,c,d){"use strict";return function(){return a.createElement(c.frames.messagePanelFrame,{className:"list-save-failed-panel",editorAPI:this.getEditorAPI(),panelName:this.props.panelName,confirmLabel:"list_dbe_general_error_button",panelTitle:this.translateIfNeeded("list_dbe_general_error_dialog_title")},a.createElement("div",{className:"content-wrapper"},a.createElement(d.symbol,{name:"plaster",className:"error-img"}),a.createElement("div",{className:"msg-text"},a.createElement("p",{},this.translateIfNeeded("list_dbe_general_error_dialog_subtitle")),a.createElement("p",{},this.translateIfNeeded("list_dbe_general_error_dialog_text")),a.createElement("p",{},a.createElement("br",{})),a.createElement("p",{},this.translateIfNeeded("list_dbe_general_error_dialog_text_2")),a.createElement("a",{className:"support-link",href:"https://www.wix.com/support/html5/"},"https://www.wix.com/support/"))))}});define("databaseEditor/panels/saveFailedMessagePanel",["react","util","lodash","core","databaseEditor/panels/saveFailedMessagePanel.rt"],function(a,b,c,d,e){"use strict";return a.createClass({displayName:"saveFailedMessagePanel",mixins:[b.translationMixin,d.mixins.editorAPIMixin],render:e})});define("databaseEditor/panels/loadFailedMessagePanel.rt",["react","lodash","panels","baseUI"],function(a,b,c,d){"use strict";return function(){return a.createElement(c.frames.confirmationPanelFrame,{panelName:this.props.panelName,panelTitle:this.translateIfNeeded("list_dbe_loading_error_title"),className:"list-load-failed-panel",onConfirm:this.props.onConfirm,onCancel:this.props.onCancel,confirmLabel:"list_dbe_loading_error_button",cancelLabel:"list_dbe_error_loading_close_manage_items"},a.createElement(d.symbol,{name:"plaster",className:"error-img"}),a.createElement("div",{className:"msg-text"},a.createElement("span",{},this.translateIfNeeded("list_dbe_loading_error_subtitle")),a.createElement("span",{},this.translateIfNeeded("list_dbe_loading_error_text")),a.createElement("a",{className:"support-link",href:"https://www.wix.com/support/html5/"},"https://www.wix.com/support/")))}});define("databaseEditor/panels/loadFailedMessagePanel",["react","util","lodash","databaseEditor/panels/loadFailedMessagePanel.rt"],function(a,b,c,d){"use strict";return a.createClass({displayName:"loadFailedMessagePanel",mixins:[b.translationMixin],render:d})});define("databaseEditor/panels/panels",["databaseEditor/panels/deleteItemsConfirmationPanel","databaseEditor/panels/saveFailedMessagePanel","databaseEditor/panels/loadFailedMessagePanel"],function(a,b,c){"use strict";return{deleteItemsConfirmationPanel:a,saveFailedMessagePanel:b,loadFailedMessagePanel:c}});define("databaseEditor/bi/events",[],function(){"use strict";var a=59;var b="listim2";return{LIST_DB_MANAGER_OPENED:{src:a,endpoint:b,evid:107,fields:{list_part_id:"string"}},LIST_DB_MANAGER_ERROR_LOADING:{src:a,endpoint:b,evid:108,fields:{list_part_id:"string",error_description:"string"}},LIST_DB_MANAGER_REORDER_ITEMS_DROP:{src:a,endpoint:b,evid:109,fields:{item_id:"string",list_part_id:"string",selector_id:"string"}},LIST_DB_MANAGER_ADD_NEW_ITEM_CLICK:{src:a,endpoint:b,evid:110,fields:{origin:"string",list_part_id:"string",selector_id:"string",item_id:"string"}},LIST_DB_MANAGER_SELECT_ITEM_CLICK:{src:a,endpoint:b,evid:113,fields:{list_part_id:"string",item_id:"string",state_after_click:"bool"}},LIST_DB_MANAGER_SELECT_ALL_CLICK:{src:a,endpoint:b,evid:114,fields:{list_part_id:"string",state_after_click:"bool"}},LIST_DB_MANAGER_DUPLICATE_ITEM:{src:a,endpoint:b,evid:117,fields:{origin:"string",list_part_id:"string",selector_id:"string",source_item_ids:"string"}},LIST_DB_MANAGER_DELETE_ITEMS_CLICK:{src:a,endpoint:b,evid:118,fields:{origin:"string",list_part_id:"string",selector_id:"string",item_ids:"string"}},LIST_DB_MANAGER_EDIT_ITEM_CLICK:{src:a,endpoint:b,evid:119,fields:{origin:"string",list_part_id:"string",item_id:"string"}},LIST_DB_MANAGER_LIST_LOAD_FAIL:{src:a,endpoint:b,evid:121,fields:{list_part_id:"string",repo_loaded:"bool",data_loaded:"bool"}}}});define("databaseEditor/bi/service",["databaseEditor/bi/events","pLoader!santa:utils"],function(a,b){"use strict";function c(a){this._reportBI=a}c.prototype={sendEvent:function(a,c){try{this._reportBI(a,c)}catch(a){b.log.info("Error sending BI event",a)}},dbEditorOpenSuccess:function(b){this.sendEvent(a.LIST_DB_MANAGER_OPENED,{list_part_id:b})},dbEditorOpenFailed:function(b,c){this.sendEvent(a.LIST_DB_MANAGER_ERROR_LOADING,{list_part_id:b,error_description:c.toString()})},listLoadFailed:function(b,c,d){this.sendEvent(a.LIST_DB_MANAGER_LIST_LOAD_FAIL,{list_part_id:b,repo_loaded:c?"true":"false",data_loaded:d?"true":"false"})},itemMove:function(b,c,d){this.sendEvent(a.LIST_DB_MANAGER_REORDER_ITEMS_DROP,{item_id:d,list_part_id:b,selector_id:c})},itemAdd:function(b,c,d,e){this.sendEvent(a.LIST_DB_MANAGER_ADD_NEW_ITEM_CLICK,{origin:b,list_part_id:c,selector_id:d,item_id:e})},itemsDuplicate:function(b,c,d,e){this.sendEvent(a.LIST_DB_MANAGER_DUPLICATE_ITEM,{origin:b,list_part_id:c,selector_id:d,source_item_ids:e.join(",")})},itemsDelete:function(b,c,d,e){this.sendEvent(a.LIST_DB_MANAGER_DELETE_ITEMS_CLICK,{origin:b,list_part_id:c,selector_id:d,item_ids:e.join(",")})},itemEdit:function(b,c,d){this.sendEvent(a.LIST_DB_MANAGER_EDIT_ITEM_CLICK,{origin:b,list_part_id:c,item_id:d})},itemSelectionToggle:function(b,c,d){this.sendEvent(a.LIST_DB_MANAGER_SELECT_ITEM_CLICK,{list_part_id:b,item_id:c,state_after_click:!!d})},allItemsSelectionToggle:function(b,c){this.sendEvent(a.LIST_DB_MANAGER_SELECT_ALL_CLICK,{list_part_id:b,state_after_click:!!c})}};return c});define("databaseEditor",["databaseEditor/dbEditor/dbEditor","databaseEditor/dataService/DataService","databaseEditor/dbEditor/DbEditorApi","databaseEditor/panels/panels","databaseEditor/bi/service"],function(a,b,c,d,e){"use strict";return{dbEditor:a,DataService:b,DbEditorApi:c,panels:d,BIService:e}});