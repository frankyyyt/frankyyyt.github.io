define("tpa/bi/errors.json",[],function(){return{SDK_SET_HEIGHT_ERROR:{errorCode:190,desc:"sdk - set height with a big number",severity:"error",params:{p1:"height"}},SDK_PUBSUB_PUBLISH_ERROR:{errorCode:191,desc:"sdk - pubSub: publish error. App not installed on site - cannot find appDefId",severity:"error"},SDK_NAVIGATION_TO_SECTION_ERROR:{errorCode:192,desc:"sdk - navigate to section failed",severity:"error",params:{p1:"appDefinitionName",p2:"sectionId"}},ECOM_MISSING_PAGES:{errorCode:300,desc:"missing ecom pages",severity:"error"},APP_IS_NOT_RESPONSIVE:{errorCode:302,desc:"monitoring apps that are down",severity:"error",params:{p1:"endpoint",p2:"app_id"}}}});define("tpa/bi/errors",["tpa/bi/errors.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;b.forEach(a,function(a,b){a.errorName=b});d.register("tpa","error",a);return a});define("tpa/services/clientSpecMapService",["lodash"],function(a){"use strict";var b=function(b){var c=b.widgets;if(c){return a.find(c,function(a){return a.appPage&&a.appPage.name&&!a.appPage.hidden})}return undefined};return{getMainSectionWidgetData:b}});define("tpa/utils/tpaUtils",["lodash"],function(a){"use strict";var b="TPA_PUB_SUB_";var c;var d=function(){if(a.isUndefined(c)){c=e()}return c};function e(){return a.now()+""}var f=function(a,b){var c=a.getComponentById(b);var d=c&&a.getSiteData().getClientSpecMapEntry(c.props.compData.applicationId);return d};var g=function(a){return a.getSiteData().getClientSpecMap()};var h=function(a,b){var c=f(a,b);return c?c.appDefinitionId:null};var i=function(a){var c=new RegExp("^"+b);return a.replace(c,"")};var j=function(a){return b.concat(a)};var k=function(b){var c=a.get(b,"props.structure.componentType");return c==="wysiwyg.viewer.components.tpapps.TPASection"||c==="wysiwyg.viewer.components.tpapps.TPAMultiSection"};var l=function(b,c){b=b||"0.0.0";c=c||"1.41.0";var d=a.map(b.split("."),function(a){return parseInt(a,10)});var e=a.map(c.split("."),function(a){return parseInt(a,10)});if(d.length===3&&e.length===3){return d[0]>=e[0]&&d[1]>=e[1]&&d[2]>=e[2]}return false};var m=function(b){var c=b.cookieUtils.getCookie("_wixUIDX")||"";c=c.slice(a.lastIndexOf(c,"|")+1);c=c.replace(/^(null-user-id|null)$/g,"");return c};var n=function(a,b){var c=g(a);var d=c[b]&&c[b].instance.split(".")[1];return d&&JSON.parse(window.atob(d))};var o=0;var p=function(){++o};var q=function(a){--o;r(a)};var r=function(){if(o===0){o=1e3}};var s=function(b,c){if(b&&c){if(a.includes(c,"$TPA$")){c=c.substr(0,c.indexOf("$TPA$"))}var d=a.find(b.widgets,function(b){return a.get(b,"appPage.id")===c});if(d){return a.get(d,"appPage.hideFromMenu")}return false}return false};return{Constants:{TPA_PUB_SUB_PREFIX:b,TOP_PAGE_ANCHOR_PREFIX:"TOP_PAGE_"},getCacheKiller:d,getRandomCacheKiller:e,getAppData:f,getAppDefId:h,stripPubSubPrefix:i,addPubSubEventPrefix:j,isTPASection:k,sdkVersionIsAtLeast:l,getVisitorUuid:m,getInstance:n,getClientSpecMap:g,incAppCounter:p,decAppCounter:q,reportAppCounter:r,isPageMarkedAsHideFromMenu:s}});define("tpa/mixins/tpaCompBaseMixin",["zepto","lodash","reactDOM","tpa/bi/errors","tpa/services/clientSpecMapService","tpa/utils/tpaUtils"],function(a,b,c,d,e,f){"use strict";var g={mobile:"unavailableInMobile",https:"unavailableInHttps"};var h=function(d){var e=c.findDOMNode(d),f=a(e).offset();return b.assign({scrollTop:document.body.scrollTop||document.documentElement.scrollTop,scrollLeft:document.body.scrollLeft||document.documentElement.scrollLeft,documentHeight:a(document.body).height(),documentWidth:a(document.body).width(),x:f.left,y:f.top},e.getBoundingClientRect())};return{ALIVE_TIMEOUT:2e4,OVERLAY_GRACE:5e3,scrollDataQueue:[],onScroll:function(){var a=h(this);var c=this;c.scrollDataQueue.push(a);b.delay(function(){if(!b.isEmpty(c.scrollDataQueue)){var a=c.scrollDataQueue.pop();c.scrollDataQueue=[];c.sendPostMessage({intent:"addEventListener",eventType:"SCROLL",params:a})}},250)},isUnderMobileView:function(){return this.props.siteData.isMobileView()},getEcomParams:function(){var a=this.getAppData();return a.appDefinitionId==="1380b703-ce81-ff05-f115-39571d94dfcd"&&this.props.siteData.currentUrl.query["ecom-tpa-params"]},_createOverlayChildComponent:function(a,c,d,e){e=e||{};return this.createChildComponent(b.merge(e,{id:d,style:this.props.style,overlay:c,applicationId:this.props.compData.applicationId,hideOverlayFunc:this._hideOverlay}),a,d)},_hideOverlay:function(){this.setState({showOverlay:false})},_createOverlay:function(a){if(!a){return null}switch(a){case"preloader":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",a,"preloaderOverlay");case"unresponsive":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed. Please try again later."});case g.https:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed."});case g.mobile:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content is currently not optimized for mobile view."});default:return null}},getRootStyle:function(a){return b.assign({minHeight:a.height,minWidth:a.width,visibility:this.state.visibility},a)},getCompRootStyle:function(a){if(this.state&&!b.isUndefined(this.state.height)){a.height=this.state.height}if(this.state&&!b.isUndefined(this.state.width)){a.width=this.state.width}if(this.state&&(this.state.isAlive||this.state.overlay==="preloader"||this.state.overlay==="unresponsive"||this.state.overlay===g.mobile)){this.state.visibility="visible"}if(this.state.ignoreAnchors){a.zIndex=1001}else{a.zIndex=""}a=this.getRootStyle(a);return a},shouldRenderIframe:function(){var a=this.state.overlay;var c=!b.includes(g,a);var d=this.state.overlay==="unresponsive";var e=c&&!d;return e},_getIframeProperties:function(){if(!this.shouldRenderIframe()){return null}var a=this._shouldShowIframe(this.state);var b=this.buildUrl(this.getBaseUrl());return{src:b,key:b,scrolling:"no",frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id,style:{display:a?"block":"none",width:"100%",height:"100%",overflow:"hidden",position:"absolute"}}},getSkinProperties:function(){var a=this._createOverlay(this.state.overlay);var b=this._getIframeProperties();var c={"":{style:this.getCompRootStyle(this.props.style),"data-ignore-anchors":this.state.ignoreAnchors},overlay:this.state.showOverlay&&this.isNotWorker()?a:null,iframe:b?b:"remove"};this.checkIfNeedToSendMemberData();if(this.mutateSkinProperties){c=this.mutateSkinProperties(c)}return c},checkIfNeedToSendMemberData:function(){var a=this.state.shouldGetSiteMemberDetails;if(a){var b=this.props.siteAPI.getSiteAspect("siteMembers");var c=b.getMemberDetails();if(c){a.callback({authResponse:true,data:c})}}},getInitialState:function(){this.urlState="";var a=this.isUnderMobileView()&&this.isMobileReady&&!this.isMobileReady();var b=a?g.mobile:null;var c={visibility:"hidden",overlay:b,isAlive:false,registeredEvents:[],showOverlay:true,initialWidth:this.props.style.width};if(this.mutateInitialState){c=this.mutateInitialState(c)}return c},_showOverlayIfNeeded:function(){if(this.state&&this.state.isAlive===false&&!this.state.overlay){this.setState({overlay:this._getInitialOverlay(),visibility:"visible"})}},_shouldShowIframe:function(a){return!a.overlay||a.overlay==="preloader"},_getInitialOverlay:function(){if(this.isMobileReady&&this.isUnderMobileView()&&!this.isMobileReady()){return g.mobile}return"preloader"},componentWillReceiveProps:function(a){if(this.resize){this.resize(a)}},componentDidMount:function(){var a=this.state.overlay;if(this.isNotWorker()){setTimeout(this._showOverlayIfNeeded,this.OVERLAY_GRACE);if(!this.props.siteData.isViewerMode()){if(this.setOverlayState){this.setOverlayState()}}}if(!(this.state.isAlive||b.includes(g,a))&&this.isNotWorker()){this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT);f.incAppCounter()}},isNotWorker:function(){if(this.isTPAWorker){return!this.isTPAWorker()}return true},_onAppAliveTimeoutExpires:function(){this.showUnresponsiveOverlay()},showUnresponsiveOverlay:function(){if(!this.state.isAlive){this.setState({overlay:"unresponsive",visibility:"visible"},function(){this.reportBIAppNotResponsive()}.bind(this))}},reportBIAppNotResponsive:function(){var a=this.props.compData.widgetId;var c=this.getAppData();var f=a?b.get(c.widgets,a):e.getMainSectionWidgetData(c);var g={endpoint:b.get(f,"widgetUrl"),app_id:b.get(c,"appDefinitionId")};this.props.siteAPI.reportBI(d.APP_IS_NOT_RESPONSIVE,g)},componentWillUnmount:function(){this._clearAliveTimeout()},_clearAliveTimeout:function(){if(this._appAliveTimeout){clearTimeout(this._appAliveTimeout);this._appAliveTimeout=0;if(this.props){f.decAppCounter(this.props.siteAPI)}}},setAppIsAlive:function(a){this._clearAliveTimeout();this.setState({isAlive:true,overlay:this.state.overlay==="preloader"?null:this.state.overlay},a)},_isUrlSecure:function(a){return/^https/.test(a)}}});define("tpa/common/TPABaseUrlBuilder",["lodash","utils"],function(a,b){"use strict";var c=function(a){this.url=b.urlUtils.parseUrl(a);this.url.query=this.url.query||{};this.url.search=null};c.prototype={addQueryParam:function(b,c){var d=this.url.query;if(c&&!a.isEmpty(c)){if(!d[b]){d[b]=c}else if(a.isArray(d[b])){d[b].push(c)}else{d[b]=[d[b],c]}}return this},addMultipleQueryParams:function(b){if(b&&!a.isEmpty(b)){a.assign(this.url.query,b)}return this},mutateIframeSrc:function(a){if(a){this.url=a(this.url)}return this},filterQueryParams:function(b){if(b&&!a.isEmpty(b)){this.url.query=a.pick(this.url.query,b)}return this},build:function(){return b.urlUtils.buildFullUrl(this.url)}};return c});define("tpa/common/TPAUrlBuilder",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){"use strict";var d=function(a){c.call(this,a)};d.prototype=a.assign(new c,{addCacheKiller:function(a){return this.addQueryParam("cacheKiller",a)},addInstance:function(a){return this.addQueryParam("instance",a)},addWidth:function(a){return this.addQueryParam("width",a)},addLocale:function(a){return this.addQueryParam("locale",a)},addViewMode:function(a){return this.addQueryParam("viewMode",a)},addCompId:function(a){return this.addQueryParam("compId",a)},addDeviceType:function(a){return this.addQueryParam("deviceType",a)},addEndpointType:function(a){return this.addQueryParam("endpointType",a)},addOrigCompId:function(a){return this.addQueryParam("origCompId",a)},addExternalId:function(a){return this.addQueryParam("externalId",a)},addOrigin:function(a){return this.addQueryParam("origin",a)}});return d});define("tpa/mixins/tpaUrlBuilderMixin",["lodash","utils","tpa/utils/tpaUtils","tpa/common/TPAUrlBuilder"],function(a,b,c,d){"use strict";var e=function(a,b){if(a.mutateIframeUrlQueryParam){b=a.mutateIframeUrlQueryParam(b)}return b};return{getInitialState:function(){this.viewMode=this.getViewMode()},getViewMode:function(){return this.props.siteData.isViewerMode()?"site":this.props.siteData.renderFlags.componentViewMode},buildUrl:function(b,f){var g=this.state.queryParams||{};g=a.merge(g,e(this,g));if(this.getEcomParams&&this.getEcomParams()){g["ecom-tpa-params"]=this.getEcomParams()}var h=new d(b).addCompId(this.props.id).addDeviceType(this.getDeviceType(this)).addInstance(this.getAppData(this).instance).addLocale(this.props.siteData.rendererModel.languageCode).addViewMode(this.viewMode).addCacheKiller(c.getCacheKiller()).addExternalId(this.props.compData.referenceId).filterQueryParams(f).addMultipleQueryParams(g);if(this.mutateIframeSrc){h.mutateIframeSrc(this.mutateIframeSrc)}return h.build()}}});define("tpa/mixins/tpaCompApiMixin",["lodash","reactDOM"],function(a,b){"use strict";return{SUPPORTED_SITE_EVENTS:{SCROLL:"SCROLL",PAGE_NAVIGATION:"PAGE_NAVIGATION",PAGE_NAVIGATION_IN:"PAGE_NAVIGATION_IN",PAGE_NAVIGATION_OUT:"PAGE_NAVIGATION_OUT",PAGE_NAVIGATION_CHANGE:"PAGE_NAVIGATION_CHANGE",STATE_CHANGED:"STATE_CHANGED",SESSION_CHANGED:"SESSION_CHANGED"},isEventSupported:function(a){return!!this.SUPPORTED_SITE_EVENTS[a]},isCompListensTo:function(b){return a.includes(this.state.registeredEvents,b)},getAppData:function(){return this.props.siteData.rendererModel.clientSpecMap[this.props.compData.applicationId]||{}},getDeviceType:function(){return this.props.siteData.isMobileView()?"mobile":"desktop"},sendPostMessage:function(a){this.props.siteAPI.getSiteAspect("tpaPostMessageAspect").sendPostMessage(this,a)},getIframe:function(){return this.refs.iframe&&b.findDOMNode(this.refs.iframe)},startListen:function(b){if(this.isEventSupported(b)){this.setState({registeredEvents:this.state.registeredEvents.concat(b)});if(this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL){this.props.siteAPI.getSiteAspect("windowScrollEvent").registerToScroll(this)}if(this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)||this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION_CHANGE)){this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").registerToPageChanged(this,b)}if(this.props&&b===this.SUPPORTED_SITE_EVENTS.SESSION_CHANGED){this.props.siteAPI.getSiteAspect("svSessionChangeEvent").registerToSessionChanged(this)}}},stopListen:function(b){this.setState({registeredEvents:a.without(this.state.registeredEvents,b)});if(this.props&&b===this.SUPPORTED_SITE_EVENTS.SCROLL){this.props.siteAPI.getSiteAspect("windowScrollEvent").unregisterToScroll(this,b)}if(this.props&&a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)){this.props.siteAPI.getSiteAspect("tpaPageNavigationAspect").unregisterToPageChanged(this)}if(this.props&&b===this.SUPPORTED_SITE_EVENTS.SESSION_CHANGED){this.props.siteAPI.getSiteAspect("svSessionChangeEvent").unRegisterToSessionChanged(this)}},setSiteMemberDataState:function(a){this.setState({shouldGetSiteMemberDetails:a})},hasOrigComponent:function(){return!a.isUndefined(this.props.compData.origCompId)},setQueryParams:function(b){if(a.isObject(b)){this.setState({queryParams:b})}},componentWillUnmount:function(){var a=this.props.id;var b=this.getAppData().appDefinitionId;this.props.siteAPI.getSiteAspect("tpaPubSubAspect").deleteCompListeners(b,a)}}});define("tpa/mixins/tpaWidgetMixin",[],function(){"use strict";return{getBaseUrl:function(){var a=this.getAppData();if(a.widgets){var b=this.props.compData.widgetId;var c=a.widgets[b];if(c){var d=this.isInMobileDevMode&&this.isInMobileDevMode();if(this.isUnderMobileView()){var e=c.mobileUrl&&(d||c.mobilePublished);return e?c.mobileUrl:c.widgetUrl}return c.widgetUrl}}return""}}});define("tpa/mixins/tpaResizeWindowMixin",["lodash"],function(a){"use strict";function b(b){return a.isString(b)&&/^[0-9]+%$/.test(b)}function c(c){return a.isNumber(c)&&c>=0||b(c)}return{resizeWindow:function(a,b,d){var e={};this.registerReLayout();if(c(b)){e.height=b}if(c(a)){e.width=a}this.setState(e,d)}}});define("tpa/components/tpaWidget",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar;var i=b.compMixins;var j={displayName:"TPAWidget",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],mutateIframeUrlQueryParam:function(b){b.width=this.state.initialWidth;var c=this.props.structure.originCompId;if(c&&!a.isEmpty(c)){b.originCompId=c}return b}};h.register("wysiwyg.viewer.components.tpapps.TPAWidget",j);return j});define("tpa/mixins/tpaSectionMixin",["lodash","tpa/utils/tpaUtils","experiment"],function(a,b,c){"use strict";return{isTPASection:true,getSiteAdditionalDataFromProps:function(a){var b=a.siteData.getExistingRootNavigationInfo(a.rootId);return b&&b.pageAdditionalData||""},mutateSkinProperties:function(a){if(typeof a.iframe==="object"){a.iframe.src=this.buildUrl(this.getBaseUrl())}return a},mutateInitialState:function(a){a.sectionUrlState=this.getSiteAdditionalDataFromProps(this.props);a.sectionUrl=this.fixSectionUrl();return a},fixSectionUrl:function(){var a=this.props.siteAPI.getPageUrl(true);return this.endsWith(a,"/")?a:a+"/"},endsWith:function(b,c){return a.endsWith(b,c)},isViewerMode:function(){return this.getViewMode()==="site"},componentWillReceiveProps:function(b){if(c.isOpen("deepLinking")){var d=this.getSiteAdditionalDataFromProps(b);if(!a.isUndefined(this.state.pushState)){this.urlState=this.state.pushState;this.setState({pushState:undefined})}else if(b.currentUrlPageId===this.props.pageId&&this.isViewerMode()){if(this.urlState!==d){this.urlState=d;this.setState({sectionUrlState:d})}}this.reportStateChanged(d)}else{var e=this.state.sectionUrlState;var f=this.getSiteAdditionalDataFromProps(b);if(e!==f||a.isEmpty(f)&&!a.isEmpty(this.state.pushState)){if(this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)){this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:f}})}}if(b.currentUrlPageId===this.props.rootId){var g=this.props.siteData;var h=g.getExistingRootNavigationInfo(this.props.rootId);var i=h.pageAdditionalData;if(this.state.pushState){if(i!==e&&i!==this.state.pushState||this.props.currentUrlPageId!==b.currentUrlPageId){this.setState({sectionUrlState:f,sectionUrl:this.fixSectionUrl(),pushState:undefined})}}else if(i!==e){this.setState({sectionUrlState:f,sectionUrl:this.fixSectionUrl()})}}}},reportStateChanged:function(a){if(this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)){this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:a}})}},isMobileReady:function(){var b=this.getAppData();var c=this.isInMobileDevMode&&this.isInMobileDevMode();var d=this.props.compData;var e=a.get(b,"widgets");if(e&&d.widgetId){var f=e[d.widgetId];return f.mobileUrl&&(c||f.mobilePublished)}return b.sectionMobileUrl&&(c||b.sectionMobilePublished)},mutateIframeUrlQueryParam:function(a){if(this.props.siteData.isViewerMode()){if(c.isOpen("deepLinking")){a["section-url"]=this.fixSectionUrl()}else{a["section-url"]=this.state.sectionUrl}a.target="_top"}else{a["section-url"]=this.getBaseUrl();a.target="_self"}a.width=this.state.initialWidth;return a},mutateIframeSrc:function(a){a=this.addStateToUrlObj(a,this.state.sectionUrlState);return a},addStateToUrlObj:function(a,b){if(b){var c=b.charAt(0)==="#";if(c){a.hash=b}else{if(a.path&&a.path.slice(-1)!=="/"){a.path+="/"}a.path+=b}}return a}}});define("tpa/components/tpaSection",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar;var i=b.compMixins;var j={displayName:"TPASection",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],getBaseUrl:function(){var b=this.getAppData();var c=this.props.compData.widgetId;var d=b.sectionUrl;var e=b.sectionDefaultPage;var f=this.props.compData.type;var g=this.isUnderMobileView()&&this.isMobileReady();if(f==="TPAWidget"&&c){var h=a.find(b.widgets,{widgetId:c});if(h){e=h.appPage.defaultPage;if(g){d=h.mobileUrl}else{d=h.widgetUrl}}}else if(g){d=b.sectionMobileUrl}if(e&&!a.isEmpty(e)){if(d.slice(-1)!=="/"){d+="/"}d+=e}return d}};h.register("wysiwyg.viewer.components.tpapps.TPASection",j);return j});define("tpa/components/tpaMultiSection",["lodash","core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar;var i=b.compMixins;var j={displayName:"TPAMultiSection",mixins:[i.skinBasedComp,i.timeoutsMixin,c,d,e,f,g],getBaseUrl:function(){var b=this.getAppData();var c=b.sectionUrl;var d=b.widgets[this.props.compData.widgetId];var e=b.sectionDefaultPage;if(d){if(this.isUnderMobileView()&&this.isMobileReady()){c=d.mobileUrl}else{c=d.widgetUrl}e=d.appPage.defaultPage}if(e&&!a.isEmpty(e)){if(c.slice(-1)!=="/"){c+="/"}c+=e}return c}};h.register("wysiwyg.viewer.components.tpapps.TPAMultiSection",j);return j});define("tpa/components/tpaWorker",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin"],function(a,b,c,d){"use strict";var e=a.compRegistrar;var f=a.compMixins;var g={displayName:"TPAWorker",mixins:[f.skinBasedComp,b,c,d],getBaseUrl:function(){var a=this.getAppData();return a.appWorkerUrl},mutateIframeUrlQueryParam:function(a){a.endpointType="worker";return a},mutateSkinProperties:function(a){if(a.iframe&&a.iframe.style){a.iframe.style.display="none"}return a},isTPAWorker:function(){return true}};e.register("tpa.viewer.classes.TPAWorker",g)});define("tpa/components/tpaGluedWidget",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f){"use strict";var g=a.compRegistrar;var h=a.compMixins;var i={displayName:"TPAGluedWidget",mixins:[h.skinBasedComp,h.timeoutsMixin,b,c,d,e,f],mutateIframeUrlQueryParam:function(a){a.width=this.state.initialWidth;return a}};g.register("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i)});define("tpa/aspects/TPAWorkerAspect",["lodash","core","santaProps"],function(a,b,c){"use strict";var d=function(a){return{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:a}};var e=function(a,e,f){var g="tpaWorker_"+f.applicationId;var h=d(g);var i=c.componentPropsBuilder.getCompProps(h,a,null,e);i.compData=f;return b.compFactory.getCompClass(h.componentType)(i)};function f(a){this._aspectSiteAPI=a}f.prototype={getComponentStructures:function(){var b=[];var c=this._aspectSiteAPI.getSiteData().getClientSpecMap();var e=this.getTPAWorkers(c);if(!a.isEmpty(e)){var f=d();b.push(f)}return b},getTPAWorkers:function(b){var c=a.filter(b,function(b){return a.isString(b.appWorkerUrl)&&b.permissions&&!b.permissions.revoked});return c},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap();var d=this._aspectSiteAPI.getSiteAPI();var f=this.getTPAWorkers(c);var g=[];a.forEach(f,function(a){var c=e(d,b,a);g.push(c)});return g}};return f});define("tpa/common/tpaPostMessageCommon",["lodash"],function(a){"use strict";var b={TPA_MESSAGE:"TPA",TPA_MESSAGE_PREVIEW:"TPA_PREVIEW",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",TPA_PREVIEW_RESPONSE:"TPA_PREVIEW_RESPONSE",PINGPONG_PREFIX:"pingpong:"};var c=function(a,b){var c={getSectionUrl:true,siteInfo:true,navigateToPage:true,getExternalId:true,smRequestLogin:true,getValue:true,getValues:true,getCurrentPageAnchors:true,getComponentInfo:true,navigateToSectionPage:true,getStateUrl:true,getSitePages:true};return!(a==="preview"&&c[b.type])};var d=function(b){return b.getSiteData().viewMode==="preview"&&a.get(window,"documentServices.tpa.__privates.areDocumentServicesHandlersReady")&&window.documentServices.tpa.__privates.areDocumentServicesHandlersReady()};var e=function(a,b,c){var d="";try{d=JSON.stringify(b)}catch(a){return}if(!a.postMessage){a=a.contentWindow}a.postMessage(d,c||"*")};var f=function(a,c,d){return function(f){try{e(a,{intent:d||b.TPA_RESPONSE,callId:c.callId,type:c.type,res:f,status:true})}catch(a){}}};var g=function a(c){return c===b.TPA_MESSAGE||c===b.TPA_MESSAGE2};var h=function a(c){return c===b.TPA_MESSAGE_PREVIEW};var i=function(a){return a.replace(b.PINGPONG_PREFIX,"")};var j=function(a){return a.getSiteData().viewMode};var k=function(a,e,i,k){var l;try{if(k.data){l=JSON.parse(k.data)}else if(k.originalEvent&&k.originalEvent.data){k=k.originalEvent;l=JSON.parse(k.data)}}catch(a){return}if(l&&g(l.intent)){var m=j(e);if(a){i(a,e,l,f(k.source,l))}else if(c(m,l)||!d(e)){l.origin=m==="site"?"viewer":m;i(e,l,f(k.source,l))}}else if(l&&h(l.intent)){if(a){i(a,e,l,f(k.source,l,b.TPA_PREVIEW_RESPONSE))}else{i(e,l,f(k.source,l,b.TPA_PREVIEW_RESPONSE))}}};return{Intents:b,callPostMessage:e,generateResponseFunction:f,isTPAMessage:g,fixOldPingPongMessageType:i,handleTPAMessage:k}});define("tpa/utils/sitePages",["lodash","utils","tpa/utils/tpaUtils","experiment"],function(a,b,c,d){"use strict";var e=function(c,e){var h=b.menuUtils.getSiteMenuWithoutRenderedLinks(c,false);if(d.isOpen("tpaHideFromMenu")){if(e&&e.filterHideFromMenuPages){h=f(h,c.getClientSpecMap())}}var j=l(h);var k=c.getMainPageId();var m=i(j,k);if(e&&e.includePagesUrl){m=g(c,j,a.get(e,"baseUrl"))}return m};var f=function(b,c){return a.filter(b,function(a){return!h(c,a.link)})};var g=function(c,d,e){return a.map(d,function(a){var d=c.getDataByQuery(a.id,"masterPage");a.url=b.wixUrlParser.getUrl(c,{pageId:a.id,title:d.pageUriSEO},undefined,true,e);if(a.subPages){a.subPages=g(c,a.subPages,e)}return a})};var h=function(b,d){if(a.get(d,"type")==="PageLink"){var e=a.get(d,"pageId.tpaApplicationId");var f=a.get(d,"pageId.tpaPageId");var g=a.get(b,e);return c.isPageMarkedAsHideFromMenu(g,f)}return false};var i=function(b,c){return a.map(b,function(a){a.isHomepage=j(a,c);if(a.subPages){a.subPages=i(a.subPages,c)}return a})};var j=function(b,c){return!a.isUndefined(b)&&b.id===c};var k=function(a){var b=e(a);return o(b,a)};var l=function(b){var c=[];a.forEach(b,function(b){var d=m(b);var e=b.items;a.forEach(e,function(a){var b=m(a);d.subPages=d.subPages||[];d.subPages.push(b)});c.push(d)});return c};var m=function(c){if(c.link){var d=a.get(c.link,"pageId.id");return{title:c.label||"",id:b.stringUtils.startsWith(d,"#")?d.substr(1):d,hide:!c.isVisible||false}}return{}};var n=function(a,b){return b.getDataByQuery(a,"masterPage")};var o=function(b,c){var d=[];a.forEach(b,function(b){a.forEach(b.subPages,function(a){d.push(n(a.id,c))});d.push(n(b.id,c))});return d};return{getSitePagesInfoData:e,getSitePagesData:k}});define("tpa/services/pageService",["lodash","tpa/utils/sitePages"],function(a,b){"use strict";var c={};var d=function(d){if(a.size(c)>0){return c}var e=b.getSitePagesData(d.getSiteData());a.forEach(e,function(b){if(b&&b.tpaApplicationId>0){var d={pageId:b.id,tpaId:b.tpaApplicationId,tpaPageId:b.tpaPageId};if(a.isUndefined(c[d.tpaId])){c[d.tpaId]=[]}c[d.tpaId].push(d)}});return c};return{mapPageToWidgets:d}});define("tpa/utils/tpaStyleUtils",["lodash","color","fonts","utils","experiment"],function(a,b,c,d,e){"use strict";var f="param_color_",g="param_number_",h="param_boolean_",i="param_font_";var j=function(){return{Title:"font_0",Menu:"font_1","Page-title":"font_2","Heading-XL":"font_3","Heading-L":"font_4","Heading-M":"font_5","Heading-S":"font_6","Body-L":"font_7","Body-M":"font_8","Body-S":"font_9","Body-XS":"font_10"}};var k=function(){var b=j();return a.invert(b)};var l=function(a,b){var d=c.fontUtils.parseFontStr(a);var e=c.fontUtils.getFontFamilyWithFallbacks(d.family);return{editorKey:b,lineHeight:d.lineHeight,style:d.style,weight:d.weight,size:d.size,fontFamily:d.family.toLowerCase(),value:"font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,e].join(" ")+";"}};var m=function(a){var c=a.split(",");return b({r:c[0],g:c[1],b:c[2]}).hexString()};var n=function(b,c,f){if(e.isOpen("sv_fontsRefactor")){var g=a.assign(q(f,c.getAllTheme()),F(b));var h=d.fonts.uploadedFontsUtils;var i=a(g).map(function(b){if(a.isString(b)){b=JSON.parse(b)}return b.family||b.fontFamily}).filter(function(a){return h.isUploadedFontFamily(a)}).union().value();return h.getUploadedFontFaceStyles(i,c.serviceTopology.mediaRootUrl)}return""};var o=function(b,c,d){return p(a.assign(q(d,c.getAllTheme()),F(b)),c)};var p=function(b,d){var e={};a.forEach(b,function(a){if(typeof a==="string"){a=JSON.parse(a)}e[a.family||a.fontFamily]=1});var f=c.fontUtils.getFontsUrl(e,d);if(a.includes(f,"family=null")){return""}return f};var q=function(b,c){var d={};var e=r(b,c);a.forEach(e,function(a,b){if(b.match(i)){d[b.replace(i,"")]=a}},this);return d};var r=function(a,b){var c=b[a];if(!c){return null}var d=c.style&&c.style.properties;if(!d){return null}return d};var s=function(c,e,f,g){var h=e[c];var i;if(h&&!a.isString(h)&&h.value){return{themeName:undefined,value:h.value.cssColor||h.value.color.value||h.value.rgba}}if(!f&&h&&a.isString(h)&&d.stringUtils.startsWith(h,"color_")){var j=d.colorParser.getColorValue(g,h);j=a.includes(j,",")?m(j):j;var k=b(j);if(e.hasOwnProperty("alpha-"+c)&&e["alpha-"+c]!==1){i="rgba("+k.values.rgb.join(",")+","+e["alpha-"+c]+")"}else{i=k.hexString()}return{themeName:h,value:i}}else if(!f){return{themeName:undefined,value:h}}return{themeName:undefined,value:undefined}};var t=function(b,c,e){var j=a.reduce(c,function(e,j,k){var l;var m=d.stringUtils.startsWith(k,"alpha-");if(m){return e}else if(k.match(f)){l=v(f,k);e[l]=a.get(s(k,c,m,b),"value");return e}else if(k.match(g)){l=v(g,k);e[l]=+j;return e}else if(k.match(h)){l=v(h,k);e[l]=u(j);return e}else if(k.match(i)){l=v(i,k);e[l]=a.get(x(j,b),"value");return e}},{});e(j)};var u=function(b){if(a.isBoolean(b)){return b}return b!=="false"};var v=function(a,b){return"style."+b.replace(a,"")};var w=function(a,b,c,e){var j=e.getAllTheme().THEME_DATA;var k=d.stringUtils.startsWith(a,"alpha-");if(b.hasOwnProperty(a)&&!k){if(a.match(f)){c.colors[a.replace(f,"")]=s(a,b,k,j)}else if(a.match(g)){c.numbers[a.replace(g,"")]=+b[a]}else if(a.match(h)){c.booleans[a.replace(h,"")]=u(b[a])}else if(a.match(i)){c.fonts[a.replace(i,"")]=x(b[a],j)}}};var x=function(a,b){var c=typeof a==="object"?a.value:JSON.parse(a);if(c.fontStyleParam&&c.preset==="Custom"){y(c)}else if(c.fontStyleParam&&c.theme){A(c)}else if(c.fontStyleParam){z(c,b.font)}else if(c.fontParam&&c.preset==="None"){B(c)}else if(c.fontParam){C(c)}return c};var y=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=a.size+"px";var e=Math.floor(a.size*1.25)+"px";var f=a.style.italic?"italic":"normal";var g=a.style.bold?"bold":"normal";var h="normal";var i="";i+="font:"+[f,h,g,d+"/"+e,b].join(" ")+";";i+=a.style.underline?"text-decoration:underline;":"";a.value=i};var z=function(a,b){var c=F(b);var d=c[a.preset];a.value=d.value;a.size=parseInt(d.size,10);a.family=d.fontFamily;a.style.bold=d.weight==="bold";a.style.italic=d.style==="italic";a.style.underline=false};var A=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=c.fontUtils.parseFontStr(a.preset);a.value="font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,b].join(" ")+";";a.size=parseInt(d.size,10);a.family=d.family.toLowerCase();a.style.bold=d.weight==="bold";a.style.italic=d.style==="italic";a.style.underline=false};var B=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=a.style.italic?"italic":"normal";var e=a.style.bold?"bold":"normal";var f="";f+="font-family:"+b+";font-style:"+d+";font-weight:"+e+";";f+=a.style.underline?"text-decoration:underline;":"";a.value=f};var C=function(a){a.family=a.value;a.value=D(a);a.size=0;a.style={bold:false,italic:false,underline:false}};var D=function(a){var b="font-family:"+(a.cssFontFamily||a.value)+";";b=b.replace(/''/g,"'");return b};var E=function(b,c){var d=b.getAllTheme();var e=d.THEME_DATA;var f={colors:{},numbers:{},booleans:{},fonts:{},googleFontsCssUrl:o(e.font,b,c),uploadFontFaces:n(e.font,b,c)};var g=r(c,d);if(!g){return f}a.forEach(g,function(a,c){w(c,g,f,b)});return f};var F=function(b){var c=0;return a.reduce(j(),function(a,d,e){a[e]=l(b[c++],d);return a},{})};var G=function(b){return a.reduce(b,function(b,c,d){if(d>=1&&d<=5||d>=11&&d<=35){b.push({name:"color_"+d,value:a.includes(c,",")?m(c):c})}return b},[])};var H=function(b){a.forEach(b,function(b){b.fonts=a.reject(b.fonts,{permissions:"legacy"})});return b};var I=function(b,d,e){var f=b.getSiteData();var g=f.getAllTheme().THEME_DATA;var h=d&&d.hasOrigComponent()?b.getComponentById(d.getOrigComponentId()):d;var i=(a.includes(f.santaBase,"localhost")?f.santaBase:f.santaBase.replace("http://","//"))+"/static/images/editorUI/fonts.v3.png";var j=H(c.fontUtils.getCurrentSelectablefonts(f));
var k=c.fontUtils.getWixStoredFontsCssUrls(f);if(e){var l=[c.fontUtils.getWixHelveticaUrl(f.serviceTopology)];k=k.concat(l)}return{fonts:{cssUrls:k,imageSpriteUrl:i,fontsMeta:j},siteTextPresets:F(g.font),siteColors:G(g.color),style:h?E(f,h.props.structure.styleId):{}}};return{getTextPresets:F,getSiteColors:G,getStylesForSDK:E,getStyleDataToPassIntoApp:I,getNameToFontsKeyMap:k,getValueForWixParams:t}});define("tpa/handlers/anchorHandlers",["lodash","utils","tpa/utils/tpaUtils"],function(a,b,c){"use strict";var d=function(a){return{id:a.compId,title:a.name}};var e=function(a,b,c){c(f(a))};var f=function(e){var f=e.getSiteData().getCurrentUrlPageId();var g=c.Constants.TOP_PAGE_ANCHOR_PREFIX+f;var h=b.scrollAnchors.getPageAnchors(e.getSiteData(),f,g);return a.map(h,d)};var g=function(a,c,d){var e=c.data.anchorId;var f=a.getSiteData().getCurrentUrlPageId();if(j(e,f)){var g=b.scrollAnchors.getPageTopAnchor(f);a.scrollToAnchor(g.id)}else if(h(a,e)){var k=i(a,e);if(k){a.scrollToAnchor(k)}}else if(d){d({error:{message:'anchor with id "'+e+'" was not found on the current page.'}})}};var h=function(b,c){var d=f(b);return a.some(d,{id:c})};function i(a,b){var c=a.getComponentById(b);var d=c.props.compData;return d&&d.id}function j(a,c){var d=b.scrollAnchors.getPageTopAnchor(c);return a===d.compId}return{getCurrentPageAnchors:e,navigateToAnchor:g}});define("tpa/handlers/tpaHandlers",["zepto","lodash","react","core","utils","animations","tpa/utils/sitePages","tpa/services/pageService","tpa/services/clientSpecMapService","tpa/utils/tpaUtils","tpa/utils/tpaStyleUtils","tpa/bi/errors","reactDOM","tpa/handlers/anchorHandlers","experiment","wixUrlParser"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q=e.logger;var r=1e6;var s=d.activityTypes.TPAActivity,t=d.activityService;var u={APP:"APP",COMPONENT:"COMPONENT"};var v=function(a,b,c){var d={};var e=a.getSiteData().getDataByQuery(a.getSiteData().getCurrentUrlPageId());var f=a.getSiteData().getCurrentUrlPageTitle();if(j.sdkVersionIsAtLeast(b.version,"1.42.0")){d.pageTitle=f}else{d.siteTitle=f;d.pageTitle=e.title}d.siteDescription=e.descriptionSEO;d.siteKeywords=e.metaKeywordsSEO;var g=a.getSiteData().currentUrl;d.url=g.full;d.baseUrl=a.getSiteData().getExternalBaseUrl();d.referer=document.referrer;c(d)};var w=function(a,c){var d=a.getComponentById(c.compId);if(d&&j.isTPASection(d)&&b.get(d,"props.pageId")===a.getSiteData().getCurrentUrlPageId()){var e=a.getPageData();var f=b.get(c,"data.title")||b.get(e,"title","");var g=b.get(c,"data.description")||b.get(e,"descriptionSEO","");a.setRunTimePageTitle(b.unescape(f),g)}};var x=function(a,b){var c=typeof b.data==="number"?b.data:b.data.height;if(c>r){var d={height:c};q.reportBI(a.getSiteData(),l.SDK_SET_HEIGHT_ERROR,d)}var e={height:c,ignoreAnchors:b.data.overflow};var f=a.getComponentById(b.compId);f.registerReLayout();f.setState(e)};var y=function(a,b,c){c(a.getSiteData().getCurrentUrlPageId())};var z=function(a,c,d){var e={filterHideFromMenuPages:true,includePagesUrl:b.get(c,"data.includePagesUrl",false)};d(g.getSitePagesInfoData(a.getSiteData(),e))};var A=function(a,c,d){var e=a.getComponentsByPageId(c);var f=b.find(e,"isTPASection");if(f){f.setState({sectionUrlState:d})}};var B=function(a,c,d,e,f){if(c){var g,h,i=false,j=d.data;if(b.isObject(d.data)){j=d.data.state;h=b.get(d.data.sectionIdentifier,"sectionId");i=b.get(d.data.sectionIdentifier,"noTransition")}if(b.isUndefined(e)||b.isEmpty(e)){E(a,c.appDefinitionName,h);f({error:{message:'Page with app "'+c.appDefinitionName+'" was not found.'}})}else{if(b.isUndefined(h)){g=e[0].pageId}else{var k=b.find(e,{tpaPageId:h});if(b.isUndefined(k)){E(a,c.appDefinitionName,h);f({error:{message:'App page with sectionId "'+h+'" was not found.'}});return}g=k.pageId}A(a,g,j);var l={pageId:g,pageAdditionalData:j};if(i){l.transition="none"}D(a,l)}}else{E(a);f({error:{message:"Component was not found."}})}};var C=function(a,b,c){var d=a.getComponentById(b.compId);var e,f;if(d){var g=h.mapPageToWidgets(a);e=d.getAppData();f=e&&g[e.applicationId]}B(a,e,b,f,c)};function D(a,b,c,d){if(b.pageId===a.getSiteData().getPrimaryPageId()){a.updatePageNavInfo(b,c,d)}else{a.navigateToPage(b,c,d)}}var E=function(a,b,c){var d={appDefinitionName:b||"",sectionId:c||""};q.reportBI(a.getSiteData(),l.SDK_NAVIGATION_TO_SECTION_ERROR,d)};var F=function(a,b){a.scrollSiteBy(b.data.x,b.data.y)};var G=function(a,b){a.scrollSiteTo(b.data.x,b.data.y)};var H=function(a,c,d){var e=b.get(c,"data.pageId");var f=b.get(c,"data.noTransition");var g=b.get(c,"data.anchorId");if(a.getSiteData().getPrimaryPageId()===e){if(g){n.navigateToAnchor(a,c,d)}}else{I(a,e,f,function(){if(g){n.navigateToAnchor(a,c,d)}},d)}};function I(a,c,d,e,f){if(b.includes(a.getSiteData().getAllPageIds(),c)){var g=a.getSiteAspect("actionsAspect");g.registerNavigationComplete(e);var h={pageId:c};if(d){h.transition="none"}a.navigateToPage(h)}else if(f){f({error:{message:'Page id "'+c+'" was not found.'}})}}var J=function(a,c,d){var e=c.data.pageId;var f=c.data.compId;var g=a.getSiteData();var h=g.getFocusedRootId();var i=a.getComponentById(f);if(i&&i.props.structure.componentType==="wysiwyg.viewer.components.tpapps.TPAGluedWidget"){d({error:{message:"Navigation to glued widget not supported."}});return}if(!b.isEmpty(e)&&e!==h){I(a,e,c.data.noPageTransition,K.bind(null,a,i,f,e,d),d)}else{K(a,i,f,e,d)}};var K=function(a,c,d,e,g){e=e||a.getSiteData().getFocusedRootId();c=c||M(a,d,e);if(!c||!L(c)&&c.props.rootId!==e){var h=b.isEmpty(e)?"Current page":'Page id "'+e+'"';g({error:{message:h+' does not contain the component id "'+d+'".'}});return}var i=N(c,a);f.animate("BaseScroll",a.getSiteContainer(),1,0,{y:i.y,x:i.x,callbacks:{onComplete:g}})};var L=function(a){return a.props.rootId==="masterPage"};var M=function(a,b,c){var d=a.getComponentsByPageId(c);return d[b]};var N=function(a,c){var d=c.getSiteData();var f=m.findDOMNode(a);var g=d.measureMap.siteMarginTop||0;var h=e.domMeasurements.getElementRect(f);var i=h.top+g;if(b.get(d,"measureMap.custom.SITE_HEADER.isFixedPosition")){i-=d.measureMap.height.SITE_HEADER}var j=e.scrollAnchors.normalizeYOffset(i,d);var k=h.left;return{x:k,y:j}};var O=function(c,d,e){var f=c.getSiteData();var g=c.getComponentById(d.compId);var h=m.findDOMNode(g);var i=b.get(f,"measureMap.custom.SITE_HEADER.isFixedPosition");var j=0;if(i){j=f.measureMap.height.SITE_HEADER}e({rect:P(h,j),offsets:Q(a(h).offset(),j)})};var P=function(a,c){var d=a.getBoundingClientRect();var e=b(d).pick(["left","right","top","bottom","height","width"]).mapValues(function(a){return Math.floor(a)}).value();if(c){e.top-=c}return e};var Q=function(a,b){return{x:a.left,y:a.top-b}};var R=function(a,b,c){var d=a.getComponentById(b.compId);var e=a.getSiteAspect("tpaModalAspect");e.showModal(Y(b,d),c)};var S=function(a,b,c){var d=a.getComponentById(b.compId);if(!T(d)){var e=new Error;e.name="Operation not supported";e.message="An app can not open a popup from a modal.";throw e}var f=a.getSiteAspect("tpaPopupAspect");f.showPopup(Y(b,d),c)};var T=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAModal"];return!b.includes(c,a.props.structure.componentType)};var U=function(a,b){var c=a.getComponentById(b.compId);if(c&&c.hide){c.hide(b.data)}};var V=function(a){return b.isString(a)&&/^[0-9]+%$/.test(a)};var W=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAPopup","wysiwyg.viewer.components.tpapps.TPAModal"];return a&&a.resizeWindow&&b.includes(c,a.props.structure.componentType)};var X=function(a,b,c){var d=b.data.width;var e=b.data.height;if(!V(d)){d=parseFloat(d)}if(!V(e)){e=parseFloat(e)}var f=a.getComponentById(b.compId);if(W(f)){f.resizeWindow(d,e,c)}};var Y=function(c,d){var e=b.merge(c.data,{origCompId:c.compId});var f=m.findDOMNode(d);e.origCompStyle=a(f).offset();var g=f.getBoundingClientRect();e.origCompStyle.actualTop=g.top;e.origCompStyle.actualLeft=g.left;e.position=b.defaults(e.position||{},{origin:"FIXED",placement:"CENTER",x:0,y:0});e.position.x=$(e.position.x);e.position.y=$(e.position.y);e.windowSize={width:a(window).width(),height:a(window).height()};e.applicationId=d.props.compData.applicationId;e.tpaData=Z(d);return e};var Z=function(a){return a.props.compData.tpaData};var $=function(a){if(b.isString(a)){var c=parseInt(a,10);if(!b.isNaN(c)){return c}return 0}else if(b.isNumber(a)){return a}return 0};var _=function(a,b){var c=b.data.eventKey;var d=a.getComponentById(b.compId);if(d&&d.isCompListensTo&&!d.isCompListensTo(c)){d.startListen(c)}};var aa=function(a,b){var c=b.data.eventKey||b.data;var d=a.getComponentById(b.compId);if(d){d.stopListen(c)}};var ba=function(a,b){var c=typeof b.data==="string"?b.data:b.data.state,d=a.getComponentById(b.compId),e;var f=a.getRootOfComponentId(b.compId);var g=a.getSiteData().getExistingRootNavigationInfo(f);var h=g?g.pageId:f;try{e=JSON.parse(c);switch(e.cmd){case"zoom":d.processImageClick(e);break;case"componentReady":d.setComponentInIframeReady();break;case"navigateToDynamicPage":var i=e.args[0];var j=p.getUrl(a.getSiteData(),i);var k=p.parseUrl(a.getSiteData(),j);if(e.args[1]){k.anchorData=e.args[1]}a.handleNavigation(k,e.args[2]);break;case"navigateToAnchor":var l=e.args[0];var m=e.args[1];if(a.getSiteData().getPrimaryPageId()===l){if(m){a.scrollToAnchor(m)}}else{a.navigateToPage({pageId:l,pageAdditionalData:null,anchorData:m})}break;default:ca(a,d,h,c)}}catch(b){ca(a,d,h,c)}};var ca=function(a,b,c,d){if(j.isTPASection(b)){b.setState({pushState:d});D(a,{pageId:c,pageAdditionalData:d,transition:"none"})}};var da=function(a,b){var c=a.getComponentById(b.compId);var d=b.data.state;var e=a.getRootOfComponentId(b.compId);var f=false;var g=true;if(j.isTPASection(c)){c.setState({pushState:d});D(a,{pageId:e,pageAdditionalData:d,transition:"none"},f,g)}};var ea=function(a,c,d){var e=a.getComponentById(c.compId);if(e){var f=h.mapPageToWidgets(a);var g=a.getSiteData().getClientSpecMap()[e.props.compData.applicationId];var i=g.applicationId;if(b.isEmpty(f)||b.isUndefined(f[i])){d({error:{message:'Page with app "'+g.appDefinitionName+'" was not found.'}})}else{var j=f[i];var k=c.data.sectionIdentifier;var l=b.find(j,{tpaPageId:k})||j[0];var m;if(l){m=l.pageId}if(b.isUndefined(m)){d({error:{message:"Page was not found."}})}else{var n=a.getPageUrlFor(m);if(b.isUndefined(n)){d({error:{message:"Page was not found."}})}else{d({url:n})}}}}else{d({error:{message:"Component was not found."}})}};var fa=function(a,b,c,d){var e=c.getMemberDetails();if(e!==null){d(e)}if(a){a.setSiteMemberDataState(e?null:{callback:d})}};var ga=function(a,c,d){var e=a.getComponentById(c.compId);var f=a.getSiteAspect("siteMembers");var g=f.isLoggedIn();if(g){fa(e,c,f,function(a){d({authResponse:true,data:a})})}else{var h=b.get(c,"data.mode");var i=h&&h==="login";f.showAuthenticationDialog(function(a){d({authResponse:true,data:a})},undefined,i)}};var ha=function(a,c,d){var e=a.getSiteAspect("siteMembers");var f=e.isLoggedIn();if(f){var g=b.get(c,"data.language");e.logout(g)}else{d({onError:"No member is logged in"})}};var ia=function(a,b,c){var d=a.getComponentById(b.compId);var e=a.getSiteAspect("siteMembers");var f=e.isLoggedIn();if(f){fa(d,b,e,function(a){c(a)})}else{c(null)}};var ja=function(a,b){var c=b.data,d=a.getComponentById(b.compId),e=a.getSiteData(),f=j.getAppData(a,b.compId),g=f.instance,h={type:c.activity.type||"TPA",appDefinitionId:f.appDefinitionId||"TPA",info:c.activity.info||{},details:c.activity.details||{},contactUpdate:c.activity.contactUpdate||{},instance:g},i=function(b){if(b.userSessionToken){a.setUserSession(b.userSessionToken)}l({status:true,response:b})},k=function(a){var b={status:a.status,statusText:a.statusText,responseText:a.responseText};l({status:false,response:b})},l=function(a){d.sendPostMessage({intent:"TPA_RESPONSE",compId:b.compId,callId:b.callId,type:b.type,status:a.status,res:{response:{activityId:a.response.activityId,contactId:a.response.contactId},status:a.status}})};var m=new s(e,h);t.reportActivity(m,i,k)};var ka=function(a,b,c){c(a.getUserSession())};var la=function(a,c,d){var e=a.getComponentById(c.compId);if(e&&e.setAppIsAlive){e.setAppIsAlive()}if(b.get(e,"hasOrigComponent")){d(k.getStyleDataToPassIntoApp(a,e))}};var ma=function(a,b){return k.getStyleDataToPassIntoApp(a,b)};var na=function(a,c,d){if(b.isFunction(d)){d(a.getSiteData().getCTToken())}};var oa=function(a,c,d){c.data.messageId=Date.now();var f={ctToken:a.getSiteData().getCTToken()};var g=b.omit(c.data,"version");var h="?"+e.urlUtils.toQueryString(f);var i="//player-counters.wix.com/collector/rest/collect-js"+h;var j=function(a){d({status:"success",response:a})};var k=function(a){var b=a&&a.responseText;d({status:"error",response:b})};e.ajaxLibrary.ajax({type:"OPTIONS",url:i,data:JSON.stringify(g),dataType:"json",contentType:"application/json",success:j,error:k})};var pa=function(a,b,c){var d=a.getComponentById(b.compId);if(d){c(d.props.compData.referenceId)}};var qa=function(){};var ra=function(a,b,c){var d=a.getSiteData();var e=d.isViewerMode()?"site":d.renderFlags.componentViewMode;c({editMode:e})};var sa=function(a,c,d){var e=c.data.key;var f=c.data.scope;var g=a.getSiteData();var h=a.getComponentById(c.compId);var i=h.props.compData;var j;if(f===u.APP){j=va(g,e,"tpaData-"+i.applicationId,"masterPage")}else{var k=a.getRootOfComponentId(c.compId);j=va(g,e,i.tpaData,k)}if(b.isEmpty(j)){d({error:{message:"key "+e+" not found in "+f+" scope"}})}else{d(j)}};var ta=function(a,c,d){var e=b.uniq(c.data.keys);var f=a.getSiteData();var g=a.getRootOfComponentId(c.compId);var h=a.getComponentById(c.compId,g);var i=h.props.compData;var j=c.data.scope;var k;if(j===u.APP){var l=wa(f,"tpaData-"+i.applicationId,"masterPage");k=b.pick(l,e)}else{var m=wa(f,i.tpaData,g);k=b.pick(m,e)}if(!b.isEmpty(k)&&b(k).keys().isEqual(e)){d(k)}else{var n=b.keys(k);var o=b(n).xor(e).intersection(e).value();d({error:{message:"keys "+o+" not found in "+j+" scope"}})}};var ua=function(a,c,d){var e=a.getComponentById(c.compId);var f=e.props.compData;var g=e.getAppData();var h=L(e);var j=f.widgetId?g.widgets[f.widgetId]:i.getMainSectionWidgetData(g);var k={compId:c.compId,showOnAllPages:h,pageId:h?"":e.props.pageId,tpaWidgetId:b.get(j,"tpaWidgetId",""),appPageId:b.get(j,"appPage.id","")};d(k)};var va=function(a,c,d,e){if(!b.isEmpty(d)){var f=wa(a,d,e);if(f){return b.pick(f,c)}}return null};var wa=function(a,b,c){var d=a.getDataByQuery(b,c);if(d&&d.content){return JSON.parse(d.content)}return null};var xa=function(a,c,d){var f=a.getComponentById(c.compId);if(!f){return d({error:{message:"Component was not found."}})}var g=h.mapPageToWidgets(a);var i=a.getSiteData().getClientSpecMap()[f.props.compData.applicationId];var j=i.applicationId;if(b.isEmpty(g)||b.isUndefined(g[j])){return d({error:{message:'Page with app "'+i.appDefinitionName+'" was not found.'}})}var k=g[j];var l=b.find(k,{tpaPageId:c.data.sectionId});var m;if(l){m={pageId:l.pageId,pageAdditionalData:c.data.state}}else{m={pageId:k[0].pageId}}return d({url:e.wixUrlParser.getUrl(a.getSiteData(),m,undefined,true)})};var ya=function(a,b,c){var d=a.getComponentById(b.compId);c(d.props.structure.styleId)};var za=function(a,c,d){var e=a.getSiteData();var f=c.data.styleId;if(b.isUndefined(e.getAllTheme()[f])){d({error:{message:'Style id "'+f+'" was not found.'}})}else{var g=k.getStylesForSDK(e,f);d(g)}};return{siteInfo:v,heightChanged:x,registerEventListener:_,navigateToPage:H,smRequestLogin:ga,smCurrentMember:ia,scrollBy:F,scrollTo:G,navigateToComponent:J,postActivity:ja,getCurrentPageId:y,getUserSession:ka,boundingRectAndOffsets:O,navigateToSectionPage:C,getSitePages:z,removeEventListener:aa,appIsAlive:la,openModal:R,openPopup:S,closeWindow:U,resizeWindow:X,appStateChanged:ba,getSectionUrl:ea,getStyleDataToPassIntoApp:ma,postCountersReport:oa,getExternalId:pa,getViewMode:ra,getValue:sa,getValues:ta,getCurrentPageAnchors:n.getCurrentPageAnchors,navigateToAnchor:n.navigateToAnchor,getStateUrl:xa,getComponentInfo:ua,getStyleId:ya,getStyleParamsByStyleId:za,replaceSectionState:da,logOutCurrentMember:ha,getCtToken:na,tpaWorker:{siteInfo:v,getSitePages:z,removeEventListener:aa,registerEventListener:_,smCurrentMember:ia,appIsAlive:la,navigateToSectionPage:C,getValue:sa,getValues:ta,getViewMode:qa,getDeviceType:qa,getLocale:qa,getInstanceId:qa,getIpAndPort:qa},toWixDate:qa,getCompId:qa,getOrigCompId:qa,getWidth:qa,getLocale:qa,getCacheKiller:qa,getTarget:qa,getInstanceId:qa,getSignDate:qa,getUid:qa,getPermissions:qa,getIpAndPort:qa,getDemoMode:qa,getDeviceType:qa,getInstanceValue:qa,getSiteOwnerId:qa,getImageUrl:qa,getResizedImageUrl:qa,getAudioUrl:qa,getDocumentUrl:qa,getSwfUrl:qa,setPageMetadata:w,getPreviewSecureMusicUrl:qa,getStyleColorByKey:qa,navigateToSection:B}});define("tpa/handlers/tpaPubSubHandlers",["tpa/utils/tpaUtils","utils","tpa/bi/errors"],function(a,b,c){"use strict";var d=b.logger;return{registerEventListener:function(a,b){a.getSiteAspect("tpaPubSubAspect").subscribe(b)},publish:function(b,e){var f=e.data;var g=e.compId;var h=a.getAppDefId(b,g);if(h){f.eventKey=a.stripPubSubPrefix(f.eventKey);b.getSiteAspect("tpaPubSubAspect").publish(h,g,f)}else{d.reportBI(b.getSiteData(),c.SDK_PUBSUB_PUBLISH_ERROR)}},removeEventListener:function(b,c){var d=c.compId;var e=c.data;var f=a.getAppDefId(b,d);var g=a.stripPubSubPrefix(e.eventKey);b.getSiteAspect("tpaPubSubAspect").unsubscribe(f,d,g)}}});define("tpa/bi/events.json",[],function(){return{JS_SDK_FUNCTION_CALL:{eventId:12,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",app_id:"appId",instance_id:"instanceId",is_published:"isPublished"}},GALLERY_FUNCTION_CALL:{eventId:11,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace"}}}});define("tpa/bi/events",["tpa/bi/events.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;d.register("tpa","event",a);return a});define("tpa/common/tpaBi",["lodash","tpa/utils/tpaUtils","tpa/bi/events","utils"],function(a,b,c,d){"use strict";var e=function(a){return a?c.JS_SDK_FUNCTION_CALL:c.GALLERY_FUNCTION_CALL};var f=function(a,b){var c=a.widgets;var d=c[b.props.compData.widgetId];var e=d?d.published||d.santaEditorPublished:a.sectionPublished;return e?1:0};var g=function(a,c){var d=b.getClientSpecMap(a);var e=b.getInstance(a,c.appId);if(!d[c.appId]){throw"app definition could not be found by the given appId"}var g=a.getComponentById(c.compId);return{appId:d[c.appId].appDefinitionId,instanceId:e.instanceId,isPublished:f(d[c.appId],g)}};var h=function(b,c){c.component=b.getComponentById(c.compId);c.appId=a.get(c,"component.props.compData.applicationId");return c};var i=function(a){return a.component&&a.component.props.compData&&a.version&&a.type&&a.namespace};var j=function(c,f,j){var k=h(f,c);if(!i(k)){return}var l={visitorUuid:b.getVisitorUuid(d),sdkVersion:k.version,origin:j,fnName:k.type,namespace:k.namespace};if(k.appId){var m=g(f,k);a.merge(l,m)}var n=e(k.appId);f.reportBI(n,l)};return{sendBIEvent:j}});define("tpa/aspects/TPAPostMessageAspect",["lodash","experiment","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/handlers/tpaPubSubHandlers","tpa/utils/tpaUtils","tpa/common/tpaBi","utils"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(b){if(a.has(b,"data")&&!a.isNull(b.data)){return b.data.eventKey&&h.stringUtils.startsWith(b.data.eventKey,f.Constants.TPA_PUB_SUB_PREFIX)}};var j=function(a){if(i(a)){return e}else if(l(a.compId)){return d.tpaWorker}return d};var k=function(a,d,e){if(m(a,d.compId,d.type)){var f=c.fixOldPingPongMessageType(d.type);var h=j(d);if(h[f]){h[f].apply(this,[a,d,e]);if(b.isOpen("sv_SendSdkMethodBI")){g.sendBIEvent(d,a,d.origin||"viewer")}}}};var l=function(a){return a&&h.stringUtils.startsWith(a,"tpaWorker_")};var m=function(b,c,d){var e=c&&b.getComponentById(c);return d!=="appStateChanged"||e&&a.includes(b.getAllRenderedRootIds(),e.props.rootId)};var n=function(a){a.registerToMessage(this.handleTPAMessage.bind(this));this._siteAPI=a};n.prototype={handleTPAMessage:function(a){c.handleTPAMessage.call(this,undefined,this._siteAPI,k,a)},sendPostMessage:function(a,b){var d=a.getIframe();if(d){c.callPostMessage(d,b)}else{throw new Error("No iframe found in TPA component",a)}},callHandler:k};return n});define("tpa/mixins/tpaRuntimeCompMixin",[],function(){"use strict";return{getOrigComponentId:function(){return this.props.compData.origCompId}}});define("tpa/components/tpaPopup",["lodash","core","utils","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g){"use strict";var h=b.compRegistrar;var i=b.compMixins;var j={FIXED:"FIXED",ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",DEFAULT:"DEFAULT"};var k={bottomCenter:"BOTTOM_CENTER",bottomLeft:"BOTTOM_LEFT",bottomRight:"BOTTOM_RIGHT",center:"CENTER",centerLeft:"CENTER_LEFT",centerRight:"CENTER_RIGHT",topCenter:"TOP_CENTER",topLeft:"TOP_LEFT",topRight:"TOP_RIGHT"};var l=function(a,b,c){return a+b/2-c/2};var m=function(a,b,c){return a-(b+c)};var n=function(a,b,c){return a-(b+c)};var o=function(a,b,c){return a+b/2-c/2};var p=function(b){function c(a){return/(%)$/.exec(a)}function d(a){return/^([0-9]+)/.exec(a)}var e=0,f="";if(a.isNumber(b)){e=b}else if(a.isString(b)){var g=c(b);var h=d(b);e=h&&h[1]?parseInt(h[1],10):0;if(g&&g[1]){f=g[1]}}return{size:e,unit:f}};var q=function(b,c,d,e){var f={position:"fixed",display:"block",width:d,height:e};e=p(e);e.size=e.unit==="%"?a.min([e.size,100]):a.min([e.size,c.height]);d=p(d);d.size=d.unit==="%"?a.min([d.size,100]):a.min([d.size,c.width]);if(b.placement===k.center){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,left:"50%",top:e.unit==="%"?0:"50%"})}else if(b.placement===k.topLeft){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,left:"0px",top:"0px"})}else if(b.placement===k.topRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,right:"0px",top:"0px"})}else if(b.placement===k.topCenter){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,top:"0px",left:"50%"})}else if(b.placement===k.centerRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,top:e.unit==="%"?0:"50%",right:"0px"})}else if(b.placement===k.centerLeft){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,top:e.unit==="%"?0:"50%",left:"0px"})}else if(b.placement===k.bottomLeft){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",left:"0px"})}else if(b.placement===k.bottomRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",right:"0px"})}else if(b.placement===k.bottomCenter){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,left:"50%",bottom:"0px"})}return f};var r=function(b,c,d,e,f){var g={position:"absolute",display:"block"};var h,i;if(b.placement===k.center){e=a.min([e,d.height]);f=a.min([f,d.width]);h=o(c.top,c.height,e);i=l(c.left,c.width,f)}else if(b.placement===k.topLeft){e=a.min([e,c.top]);f=a.min([f,c.left]);h=c.top-e;i=c.left-f}else if(b.placement===k.topRight){e=a.min([e,c.top]);f=a.min([f,n(d.width,c.width,c.left)]);h=c.top-e;i=c.width+c.left}else if(b.placement===k.topCenter){e=a.min([e,c.top]);f=a.min([f,d.width]);h=c.top-e;i=l(c.left,c.width,f)}else if(b.placement===k.centerRight){e=a.min([e,d.height]);f=a.min([f,n(d.width,c.width,c.left)]);h=o(c.top,c.height,e);i=c.width+c.left}else if(b.placement===k.centerLeft){e=a.min([e,d.height]);f=a.min([f,c.left]);h=o(c.top,c.height,e);i=c.left-f}else if(b.placement===k.bottomLeft){e=a.min([e,m(d.height,c.top,c.height)]);f=a.min([f,c.left]);h=c.top+c.height;i=c.left-f}else if(b.placement===k.bottomRight){e=a.min([e,m(d.height,c.top,c.height)]);f=a.min([f,n(d.width,c.width,c.left)]);h=c.top+c.height;i=c.width+c.left}else if(b.placement===k.bottomCenter){e=a.min([e,m(d.height,c.top,c.height)]);f=a.min([f,d.width]);h=c.top+c.height;i=l(c.left,c.width,f)}h=a.max([0,h]);i=a.max([0,i]);return a.assign(g,{top:h,left:i,width:f,height:e})};var s=function(b,c,d,e,f){var g={position:"absolute",display:"block"};var h,i,j,l;if(b.placement===k.center){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*l]);h=c.top+b.y-e/2;i=c.left+b.x-f/2}else if(b.placement===k.topLeft){e=a.min([e,c.actualTop+b.y]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y-e;i=c.left+b.x-f}else if(b.placement===k.topRight){e=a.min([e,c.actualTop+b.y]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y-e;i=c.left+b.x}else if(b.placement===k.topCenter){e=a.min([e,c.actualTop+b.y]);l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*l]);h=c.top+b.y-e;i=c.left+b.x-f/2}else if(b.placement===k.centerRight){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y-e/2;i=c.left+b.x}else if(b.placement===k.centerLeft){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y-e/2;i=c.left+b.x-f}else if(b.placement===k.bottomLeft){e=a.min([e,d.height-(c.actulaTop+b.y)]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y;i=c.left+b.x-f}else if(b.placement===k.bottomRight){e=a.min([e,d.height-(c.actualTop+b.y)]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y;i=c.left+b.x}else if(b.placement===k.bottomCenter){e=a.min([e,d.height-(c.actualTop+b.y)]);l=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*l]);h=c.top+b.y;i=c.left+b.x-f/2}h=a.max([0,h]);i=a.max([0,i]);return a.assign(g,{top:h,left:i,width:f,height:e})};var t=function(b,c,d,e){var f=10;if(e.width<f||e.height<f){var g=p(d);g.size=g.unit==="%"?a.min([g.size,100]):a.min([g.size,b.height]);var h=p(c);h.size=h.unit==="%"?a.min([h.size,100]):a.min([h.size,b.width]);return{position:"fixed",display:"block",width:h.size+g.unit,height:g.size+h.unit,marginLeft:h.size/-2+g.unit,marginTop:g.size/-2+h.unit,left:"50%",top:"50%"}}return e};var u=function(a,b,c,d,e){var f={};if(a.origin===j.DEFAULT||a.origin===j.FIXED){f=q(a,c,d,e)}if(a.origin===j.RELATIVE){f=r(a,b,c,e,d)}if(a.origin===j.ABSOLUTE){f=s(a,b,c,e,d)}f=t(c,d,e,f);return f};var v=function(a){var b=a.getSiteAspect("tpaModalAspect").getReactComponents();var c=b&&b.length>0;return c?1001:null};var w={displayName:"TPAPopup",mixins:[i.skinBasedComp,d,e,f,g],getInitialState:function(){return{showComponent:true,registeredEvents:[],$displayDevice:this.getDeviceType()}},getSkinProperties:function(){var a=this.state.showComponent?this.getSelfStyle():{display:"none"};var b=this.isBareTheme()?"none":"block";if(this.state.showComponent){return{"":{style:a},closeButton:{onClick:this.hide,style:{display:b}},iframe:{src:this.buildUrl(this.props.compData.url),scrolling:"no",frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id}}}return{"":{style:a}}},mutateIframeUrlQueryParam:function(a){a.origCompId=this.props.compData.origCompId;return a},getSelfStyle:function(){var b=a.defaults(this.props.compData.position,{x:0,y:0});var c=this.props.compData.origCompStyle;var d=this.props.compData.windowSize;var e=a.isUndefined(this.state.width)?this.props.compData.width:this.state.width;var f=a.isUndefined(this.state.height)?this.props.compData.height:this.state.height;var g=u(b,c,d,e,f);g.zIndex=v(this.props.siteAPI);return this.getThemeStyle(g)},getThemeStyle:function(b){if(this.isBareTheme()){return a.merge(b,{background:"none",boxShadow:"none",borderRadius:0})}return b},hide:function(c,d){var e=this;b.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAPopup");this.setState({showComponent:false},function(){var b=c&&c.message?c:undefined;if(e.props.onCloseCallback){e.props.onCloseCallback(b)}this.props.siteAPI.getSiteAspect("tpaPopupAspect").removePopup(e);if(a.isFunction(d)){d()}})},isBareTheme:function(){return this.props.compData.theme==="BARE"}};h.register("wysiwyg.viewer.components.tpapps.TPAPopup",w);return w});define("tpa/aspects/TPAPopupAspect",["lodash","core","santaProps","utils","tpa/components/tpaPopup"],function(a,b,c,d){"use strict";function e(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:d.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""}}function f(a,d,e,f,g){var h=c.componentPropsBuilder.getCompProps(a,d,null,e);h.compData=f;h.onCloseCallback=g;return b.compFactory.getCompClass(a.componentType)(h)}function g(a){this.aspectSiteApi=a;this.shouldShowPopup=false;this.tpaPopup=[];this.aspectSiteApi.registerToUrlPageChange(this.removeAllPopups.bind(this))}g.prototype={getComponentStructures:function(){if(this.shouldShowPopup){return[e()]}return null},getReactComponents:function(a){var b;if(this.shouldShowPopup){if(this.shouldShowNewPopup){this.shouldShowNewPopup=false;var c=e();b=f(c,this.aspectSiteApi.getSiteAPI(),a,this.popupData,this.popupOnClose);this.tpaPopup.push(b)}return this.tpaPopup}return null},showPopup:function(a,b){this.shouldShowPopup=true;this.shouldShowNewPopup=true;this.popupData=a;this.popupOnClose=b;this.aspectSiteApi.forceUpdate()},removePopup:function(b){var c=b.props.id;var d=this.tpaPopup;this.tpaPopup=a.reject(d,{props:{id:c}})},removeAllPopups:function(){if(!a.isEmpty(this.tpaPopup)){this.tpaPopup=[];this.shouldShowPopup=false;this.aspectSiteApi.forceUpdate()}}};return g});define("tpa/classes/PubSubHub",["lodash","utils"],function(a,b){"use strict";var c=1e3;var d=function(a){this.hub=a||{}};d.prototype={persistData:function(a,d,e,f){var g={data:f,name:d,origin:e};var h=this._addEvent(a,d);if(h.data.length>=c){b.log.warn("You have exceeded the data limit, and some of the data will be lost! Please make sure you are not persisting unneeded data.");h.data.shift()}h.data.push(g)},addEventListener:function(b,c,d){var e=this._addEvent(b,c);if(!a.includes(e.listeners,d)){e.listeners.push(d)}},removeEventListener:function(b,c,d){var e=this._getEvent(b,c);if(e){e.listeners=a.without(e.listeners,d)}},getPersistedData:function(a,b){var c=this._getEvent(a,b);return c&&c.data},getEventListeners:function(a,b){var c=this._getEvent(a,b);return c&&c.listeners},deleteCompListeners:function(b,c){var d=this;var e=this._getAppEvents(b);a.forOwn(e,function(a,e){d.removeEventListener(b,e,c)})},_addEvent:function(a,b){var c=this.hub[a];if(!c){c=this.hub[a]={}}var d=c[b];if(!d){d=c[b]={data:[],listeners:[]}}return d},_getEvent:function(a,b){var c=this.hub[a];if(c){return c[b]}},_getAppEvents:function(a){return this.hub[a]}};return d});define("tpa/aspects/TPAPubSubAspect",["lodash","tpa/utils/tpaUtils","tpa/classes/PubSubHub"],function(a,b,c){"use strict";var d=function(a){this.aspectSiteAPI=a;this.hub=new c};d.prototype={publish:function(c,d,e){var f=e.eventKey;var g=e.isPersistent;var h=this.hub.getEventListeners(c,f);var i={eventType:b.addPubSubEventPrefix(f),intent:"addEventListener",params:{data:e.eventData,name:f,origin:d}};a.forEach(h,function(a){this._sendDataToComp(a,i)},this);if(g){var j=e.eventData;this.hub.persistData(c,f,d,j)}},subscribe:function(c){var d=c.compId;var e=c.data;var f=b.stripPubSubPrefix(e.eventKey);var g=e.receivePastEvents;var h=b.getAppDefId(this.aspectSiteAPI,d);this.hub.addEventListener(h,f,d);if(g){var i=this.hub.getPersistedData(h,f);if(!a.isEmpty(i)){var j={intent:"TPA_RESPONSE",compId:d,callId:c.callId,type:c.type,status:true,res:{drain:true,data:i}};this._sendDataToComp(d,j)}}},unsubscribe:function(a,b,c){var d=this.hub.getEventListeners(a,c);if(d){this.hub.removeEventListener(a,c,b)}},deleteCompListeners:function(a,b){this.hub.deleteCompListeners(a,b)},_sendDataToComp:function(a,b){var c=this.aspectSiteAPI.getComponentById(a);if(c){c.sendPostMessage(b)}}};return d});define("tpa/aspects/TPAPixelTrackerAspect",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){
"use strict";var d=b.urlUtils;var e=b.throttleUtils.throttledForEach;var f;var g=function(b){return a.filter(b,function(b){return a.isString(b.pixelUrl)&&b.permissions&&!b.permissions.revoked})};var h=function(a){new window.Image(0,0).src=a};var i=function(){var b=f.getPageUrl.bind(f);var h=g(f.getSiteData().getClientSpecMap());var i=a.map(h,function(a){return new c(a.pixelUrl).addMultipleQueryParams({instance:a.instance,page:b(),ck:d.cacheKiller()}).build()});e(i,j.sendRequest,j.CHUNK_SIZE,j.CHUNK_INTERVAL)};function j(a){f=a;f.registerToComponentDidMount(i);f.registerToUrlPageChange(i)}j.prototype={getReactComponents:function(){return null}};j.sendRequest=h;j.CHUNK_SIZE=1;j.CHUNK_INTERVAL=100;return j});define("tpa/aspects/TPAPageNavigationAspect",["lodash"],function(a){"use strict";var b=function(a,b,c,d){return a.type==="PAGE_NAVIGATION"||a.type==="PAGE_NAVIGATION_IN"&&d===b||a.type==="PAGE_NAVIGATION_OUT"&&d===c};var c=function(a,b){this._listeners={};this._siteAPI=a;this._currentPageId=b||this._siteAPI.getSiteData().getCurrentUrlPageId();this._siteAPI.registerToUrlPageChange(this.notifyPageChanged.bind(this))};c.prototype={notifyPageChanged:function(){var c=this._siteAPI.getSiteData().getCurrentUrlPageId(),d=this._currentPageId;a.forEach(this._listeners,function(e){a.forEach(e,function(a){var e=a.comp.props.rootId;var f=a.comp.isMounted();if(f&&b(a,c,d,e)){a.comp.sendPostMessage({intent:"addEventListener",eventType:a.type,params:{toPage:c,fromPage:d,isAppOnPage:e===c,wasAppOnPage:e===d}})}})});this._currentPageId=c},registerToPageChanged:function(a,b){var c=this._listeners[a.props.id];if(!c){c=this._listeners[a.props.id]=[]}c.push({comp:a,type:b})},unregisterToPageChanged:function(a){delete this._listeners[a.props.id]}};return c});define("tpa/mixins/tpaBlockOuterScrollMixin",[],function(){"use strict";var a=function(a){var b=a.currentTarget;var c=a.currentTarget.scrollHeight;var d=c-a.currentTarget.offsetHeight;var e=a.deltaY%3?a.deltaY:a.deltaY*10;if(b.scrollTop+e<=0){b.scrollTop=0;a.preventDefault()}else if(b.scrollTop+e>=d){b.scrollTop=d;a.preventDefault()}a.stopPropagation()};return{blockOuterScroll:a}});define("tpa/components/tpaModal",["lodash","zepto","core","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin","tpa/mixins/tpaBlockOuterScrollMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=c.compRegistrar;var j=c.compMixins;var k=50;var l={displayName:"TPAModal",mixins:[j.skinBasedComp,d,e,f,g,h],getInitialState:function(){this.props.siteAPI.getSiteAspect("windowResizeEvent").registerToResize(this);return{showComponent:true,registeredEvents:[],$displayDevice:this.getDeviceType(),windowSize:this.props.compData.windowSize}},getDefaultProperties:function(){return{"":{style:{position:"fixed",display:"block"},onWheel:this.blockOuterScroll},blockingLayer:{onClick:this.hide},frameWrap:{style:this.getIframeWrapperStyle()},dialog:{style:this.getDialogStyle()},xButton:{children:"",onClick:this.hide,style:{display:"block"}},iframe:{src:this.buildUrl(this.props.compData.url),frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id}}},getHiddenProperties:function(){return{"":{style:{display:"none"}}}},getBareProperties:function(){return a.merge(this.getDefaultProperties(),{frameWrap:{style:{background:"transparent",border:"none"}},xButton:{style:{display:"none"}}})},getSkinProperties:function(){if(this.state.showComponent){switch(this.props.compData.theme){case"BARE":case"LIGHT_BOX":return this.getBareProperties();default:return this.getDefaultProperties()}}return this.getHiddenProperties()},getIframeWrapperStyle:function(){var a=this.props.siteData.isMobileView();var b={};if(a){b={WebkitOverflowScrolling:"touch",overflowY:"scroll"}}return b},getDialogStyle:function(){if(this.getDeviceType()==="mobile"){return{}}var b=this.state.windowSize;var c=a.isNumber(this.state.width)?this.state.width:this.props.compData.width;var d=a.isNumber(this.state.height)?this.state.height:this.props.compData.height;c=Math.min(c,b.width);d=Math.min(d,b.height);var e=this.getAppData();if(!e.isWixTPA){var f=b.width-k;var g=b.height-k;if(c>=f&&d>=g){c=f;d=g}}return{width:c,height:d,marginTop:-d/2,marginLeft:-c/2}},mutateIframeUrlQueryParam:function(a){a.origCompId=this.props.compData.origCompId;return a},hide:function(b,d){c.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAModal");var e=this;this.setState({showComponent:false},function(){var c=b&&b.message?b:undefined;if(e.props.onCloseCallback){e.props.onCloseCallback(c)}if(e.state.$displayDevice==="mobile"){e.props.siteAPI.exitFullScreenMode()}e.props.siteAPI.getSiteAspect("windowResizeEvent").unregisterToResize(e);e.props.siteAPI.getSiteAspect("tpaModalAspect").removeModal(e);if(a.isFunction(d)){d()}})},isBareTheme:function(){return this.props.compData.theme==="BARE"},onResize:function(){var a=b(window);this.setState({windowSize:{width:a.width(),height:a.height()}})}};i.register("wysiwyg.viewer.components.tpapps.TPAModal",l);return l});define("tpa/aspects/TPAModalAspect",["lodash","core","santaProps","utils","tpa/components/tpaModal"],function(a,b,c,d,e){"use strict";function f(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:d.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"}}function g(a,d,e,f,g){var h=c.componentPropsBuilder.getCompProps(a,d,null,e);h.compData=f;h.onCloseCallback=g;h.key=a.id;return b.compFactory.getCompClass(a.componentType)(h)}function h(a){this.aspectSiteApi=a;this.modalStructure=null}h.prototype={getComponentStructures:function(){if(this.modalStructure){return[this.modalStructure]}return null},getReactComponents:function(a){if(this.modalStructure){return[g(this.modalStructure,this.aspectSiteApi.getSiteAPI(),a,this.modalData,this.modalOnClose)]}return null},showModal:function(a,b){if(this.aspectSiteApi.getSiteData().isMobileView()){if(a.theme==="LIGHT_BOX"){this.aspectSiteApi.exitFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(true)}else{this.aspectSiteApi.enterFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(false)}}this.modalStructure=f();this.modalData=a;this.modalOnClose=b;this.aspectSiteApi.forceUpdate()},removeModal:function(){if(this.aspectSiteApi.getSiteData().isMobileView()){this.aspectSiteApi.exitFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(false)}this.modalStructure=null;this.aspectSiteApi.forceUpdate()}};return h});define("tpa/aspects/tpaAspectCollector",["core","tpa/aspects/TPAWorkerAspect","tpa/aspects/TPAPostMessageAspect","tpa/aspects/TPAPopupAspect","tpa/aspects/TPAPubSubAspect","tpa/aspects/TPAPixelTrackerAspect","tpa/aspects/TPAPageNavigationAspect","tpa/aspects/TPAModalAspect"],function(a){"use strict";var b=a.siteAspectsRegistry;b.registerSiteAspect("tpaWorkerAspect",arguments[1]);b.registerSiteAspect("tpaPostMessageAspect",arguments[2]);b.registerSiteAspect("tpaPopupAspect",arguments[3]);b.registerSiteAspect("tpaPubSubAspect",arguments[4]);b.registerSiteAspect("tpaPixelTrackerAspect",arguments[5]);b.registerSiteAspect("tpaPageNavigationAspect",arguments[6]);b.registerSiteAspect("tpaModalAspect",arguments[7])});define("tpa/layout/gluedWidgetPatcher",["lodash"],function(a){"use strict";var b="fixed";function c(c,d,e){var f={};a.forEach(e,function(e){var g=d[e]&&d[e][c];var h=e;if(a.isUndefined(g)){return}if(e.indexOf(b)===0){h=h.slice(b.length).toLowerCase()}f[h]=g});return f}function d(b,c,d){return{top:a.isNumber(b.top)?a.parseInt(b.top):d-b.height,bottom:a.isNumber(b.bottom)?d-a.parseInt(b.bottom):a.parseInt(b.top)+b.height,right:a.isNumber(b.right)?c-a.parseInt(b.right):a.parseInt(b.left)+b.width,left:a.isNumber(b.left)?a.parseInt(b.left):c-b.width}}function e(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function f(b,c,d){if(e(d,c)&&a.isNumber(b.top)){b.top=(b.top||0)+(d.bottom-c.top)}return b}function g(a,b,c){var e=a;var g=b.height.screen;var h=b.width.screen;var i=b.custom&&b.custom[c.WIX_ADS_ID]&&b.custom[c.WIX_ADS_ID].topAd;if(i){var j=d(e,h,g);e=f(e,j,i)}return e}function h(b,d,e,f,h){var i=["position","fixedTop","fixedLeft","right","bottom","width","height"];var j=c(b,e,i);j=g(j,e,h);j=a.omit(j,"width","height");d.css(b,j)}function i(){this.patchGluedWidget=h}return i});define("tpa/layout/tpaMeasurer",["zepto"],function(a){"use strict";return{measureTPA:function(b,c,d,e,f){var g=a(d[b]);c.custom[b]={hasIframe:Boolean(d[b+"iframe"])};var h=parseInt(g.css("min-height"),10);var i=parseInt(g.css("min-width"),10);var j=g.attr("data-ignore-anchors");if(h&&j!=="true"){c.minHeight[b]=h;c.height[b]=h}if(h&&j==="true"){c.minHeight[b]=f.structure.layout.height;c.height[b]=f.structure.layout.height}if(i){c.minWidth[b]=i;c.width[b]=i}}}});define("tpa/layout/tpaGluedWidgetPlacement",[],function(){"use strict";function a(a,b){var c=a.applicationId;var d=a.widgetId;var e=b[c];if(e){var f=e.widgets[d];if(f){var g=f.gluedOptions||{horizontalMargin:0,placement:"BOTTOM_RIGHT",verticalMargin:0};return g.placement}}}return{getDefaultPlacement:a}});define("tpa/utils/gluedWidgetMeasuringUtils",["lodash","tpa/layout/tpaGluedWidgetPlacement"],function(a,b){"use strict";var c=300,d=120;function e(a){if(typeof a==="number"){return a}if(!a){return 0}return parseFloat(a)||0}function f(b,f,g,h,i,j,k){j=e(j);k=e(k);var l={};var m;function n(){if(j>=-1&&j<=1){var a=h/2-f/2;var b=h-d*2;var c=b/2-f/2;var e=j*c;l.top=a+e}else if(j<-1&&j>=-2){m=2+j;l.top=m*d}else if(j>1&&j<=2){m=2-j;var g=Math.floor(m*d);l.top=h-g-f}}function o(){if(k>=-1&&k<=1){var a=g/2-b/2;var d=g-c*2;var e=d/2-b/2;var f=k*e;l.left=a+f}else if(k>1&&k<=2){m=2-k;var h=Math.floor(m*c);l.left=g-h-b}else if(k<-1&&k>=-2){m=2+k;l.left=m*c}}switch(i){case"TOP_LEFT":l.top=0;l.left=0;l.bottom="auto";break;case"TOP_RIGHT":l.top=0;l.right=0;l.bottom="auto";break;case"TOP_CENTER":l.top=0;l.bottom="auto";o();break;case"CENTER_RIGHT":l.right=0;n();break;case"CENTER_LEFT":l.left=0;n();break;case"BOTTOM_LEFT":l.bottom=0;l.left=0;l.top="auto";break;case"BOTTOM_CENTER":l.bottom=0;l.top="auto";o();break;case"BOTTOM_RIGHT":default:l.bottom=0;l.right=0;l.top="auto";break}return a.defaults(l,{position:"fixed",top:"",left:""})}function g(b,c){var d={};if(c&&c>0){if(a.isNumber(b.bottom)&&b.bottom<c){d.bottom=c}}return d}function h(a){if(a>2||a<-2){a=0}return a}function i(c,d,e,i,j){var k=h(d.props.horizontalMargin);var l=h(d.props.verticalMargin);var m=d.props.placement||b.getDefaultPlacement(d.data,c);var n=f(d.layout.width,d.layout.height,e,i,m,l,k);var o=g(n,j||0);var p=a.assign(n,o);if(p.right===0){p.left=e-d.layout.width}if(p.bottom===0){p.top=i-d.layout.height-(j||0)}return p}return{getGluedWidgetMeasurements:i}});define("tpa/layout/gluedWidgetMeasurer",["lodash","zepto","tpa/layout/tpaMeasurer","tpa/utils/gluedWidgetMeasuringUtils"],function(a,b,c,d){"use strict";function e(a,b,c,d){var e=d.isMobileView()?"mobileWADTop":"desktopWADTop";var f=a+e;var g=c[a].querySelector("#"+f);if(g){b.custom[a]={topAd:g.getBoundingClientRect()}}}function f(a){if(a.right===0){a.left="auto"}if(a.bottom===0){a.top="auto"}if(a.left===0){a.right="auto"}if(a.top===0){a.bottom="auto"}return a}function g(e,g,h,i,j,k){var l=k.propertiesItem;var m=k.dataItem;var n=a.assign(k.layout,{height:b(i[g]).height(),width:b(i[g]).width()});var o=h.width.screen;var p=h.height.screen;l.placement=l.placement||e(m,j);var q={props:l,data:m,layout:n};var r=j.rendererModel.clientSpecMap;var s=d.getGluedWidgetMeasurements(r,q,o,p,h.siteMarginBottom);s=f(s);s.fixedTop=s.top;s.fixedLeft=s.left;delete s.top;delete s.left;a.forEach(s,function(a,b){h[b]=h[b]||{};h[b][g]=a});h.width[g]=n.width;c.measureTPA(g,h,i)}function h(a){function b(b,c){try{return a.getDefaultPlacement(b,c)}catch(a){return""}}this.measureWixAdComponent=e;this.measureGluedWidget=g.bind(this,b)}return h});define("tpa/layout/tpaSectionPatcher",["lodash","zepto","tpa/services/clientSpecMapService"],function(a,b,c){"use strict";function d(a,b,c){var d=b.height.screen-b.siteOffsetTop;a.height=d+"px";a.minHeight=d+"px";a.top=b.siteOffsetTop+"px";if(!c.isViewerMode()){a.left=undefined;a.right=undefined}return a}function e(b,d){var e=a.get(b,"widgetId");var f=e?a.get(d.widgets,e):c.getMainSectionWidgetData(d);return a.get(f,"appPage.fullPage",false)}return{patchTPASection:function(a,b,c,f,g){var h=f.dataItem;var i=g.rendererModel.clientSpecMap;var j=i[h.applicationId];var k=c.height[a];if(j&&e(h,j)){var l={};l.position="fixed";l.left="0px";l.top="0px";l.right="0px";l.bottom="0px";if(g.isMobileView()){k=c.height.screen-c.siteOffsetTop;l=d(l,c,g)}b.css(a,l)}var m=c.width[a];var n=g.os.ios&&g.browser.safari;if(n&&c.custom[a].hasIframe){b.css(a+"iframe",{width:m,height:k})}}}});define("tpa/layout/mobileSafariPatcher",[],function(){"use strict";return{patchWidth:function(a,b,c,d,e){var f=e.os.ios&&e.browser.safari;if(f&&c.custom[a].hasIframe){b.css(a+"iframe",{width:1,minWidth:"100%"})}}}});define("tpa/layout/tpaLayout",["layout","tpa/layout/gluedWidgetPatcher","tpa/layout/gluedWidgetMeasurer","tpa/layout/tpaSectionPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaGluedWidgetPlacement","tpa/layout/mobileSafariPatcher"],function(a,b,c,d,e,f,g){"use strict";var h=new b(f);var i=new c(f);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAWidget",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPASection",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAMultiSection",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i.measureGluedWidget);a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAWidget");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAGluedWidget");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPASection");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAMultiSection");a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPASection",[["iframe"]]);a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAMultiSection",[["iframe"]]);a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAWidget",[["iframe"]]);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAGluedWidget",h.patchGluedWidget);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAMultiSection",d.patchTPASection);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPASection",d.patchTPASection);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAWidget",g.patchWidth);["wysiwyg.viewer.components.WixAdsMobile","wysiwyg.viewer.components.WixAdsDesktop"].forEach(function(b){a.registerRequestToMeasureChildren(b,[["desktopWADTop"],["desktopWADBottom"],["mobileWADTop"]]);a.registerCustomMeasure(b,i.measureWixAdComponent)});return{}});define("tpa/components/tpaPreloaderOverlay",["core"],function(a){"use strict";var b=a.compRegistrar;var c=a.compMixins;var d={mixins:[c.skinBasedComp],getSkinProperties:function(){return{preloader:{className:"circle-preloader"}}}};b.register("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",d)});define("tpa/services/tpaPreviewEditorCommunicationService",["core"],function(a){"use strict";var b=[];var c=1;var d;var e=a.siteAspectsRegistry;var f=function(a){d=a;g()};e.registerSiteAspect("tpaPreviewEditorAspect",f);var g=function(){d.registerToMessage(j.bind(this))};var h=function(a,b,c,d){var e=i(a,b,c,d);var f;if(window.parent.postMessage){f=window.parent}else if(window.parent.document.postMessage){f=window.parent.document}if(f&&typeof f!=="undefined"){f.postMessage(JSON.stringify(e),"*")}};var i=function(a,d,e,f){var g={intent:"TPA_PREVIEW",callId:c++,type:a,compId:e,data:d};if(f){b[g.callId]=f}return g};var j=function(a){if(!a||!a.data){return}var c={};try{c=JSON.parse(a.data)}catch(a){return}switch(c.intent){case"TPA_PREVIEW":if(c.callId&&b[c.callId]){b[c.callId](c.res);delete b[c.callId]}break}};return{doPostMessage:h}});define("tpa/mixins/tpaPreviewEditorMixin",["tpa/services/tpaPreviewEditorCommunicationService"],function(a){"use strict";var b=function(b){a.doPostMessage("openHelp",b)};return{openHelp:b}});define("tpa/components/tpaUnavailableMessageOverlay",["core","tpa/mixins/tpaPreviewEditorMixin"],function(a,b){"use strict";var c=a.compRegistrar;var d=a.compMixins;var e={displayName:"TPAUnavailableMessageOverlay",mixins:[d.skinBasedComp,b],getInitialState:function(){return{showOverlay:true}},getSkinProperties:function(){var a={text:{children:[this.props.compData.text]},dismissButton:{onClick:this.props.compData.hideOverlayFunc},openHelp:this.openHelp};return a}};c.register("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",e)});define("tpa",["tpa/components/tpaWidget","tpa/components/tpaSection","tpa/components/tpaMultiSection","tpa/components/tpaWorker","tpa/components/tpaGluedWidget","tpa/aspects/tpaAspectCollector","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/layout/tpaLayout","tpa/components/tpaPreloaderOverlay","tpa/components/tpaUnavailableMessageOverlay","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaSectionPatcher","tpa/mixins/tpaCompBaseMixin","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/common/TPAUrlBuilder","tpa/common/TPABaseUrlBuilder","tpa/utils/tpaStyleUtils","tpa/utils/tpaUtils","tpa/utils/gluedWidgetMeasuringUtils","tpa/services/tpaPreviewEditorCommunicationService","tpa/common/tpaBi","tpa/utils/sitePages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";return{widget:a,section:b,multiSection:c,worker:d,gluedWidget:e,gluedWidgetMeasuringUtils:v,tpaMixins:{tpaUrlBuilder:g,tpaCompApi:h,tpaCompBase:o},GluedWidgetPatcher:l,tpaMeasurer:m,tpaSectionPatcher:n,tpaHandlers:q,common:{tpaPostMessageCommon:p,TPAUrlBuilder:r,styleUtils:t,TPABaseUrlBuilder:s,utils:u,bi:x},services:{tpaPreviewEditorCommunicationService:w},tpaStyleUtils:t,sitePages:y}});