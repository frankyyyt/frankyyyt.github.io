define("wixCode/utils/wixCodeWidgetService",["lodash","wixCodeInit"],function(a,b){"use strict";function c(a){return b.specMapUtils.getAppSpec(a)}function d(a){return!!c(a)}return{hasWixCodeWidgetSpecs:d,getWixCodeSpec:c}});define("wixCode/aspects/WixCodeWidgetAspect",["lodash","wixCodeInit"],function(a,b){"use strict";function c(a){this._aspectSiteAPI=a}c.prototype={initApp:function(){var c=this._aspectSiteAPI.getSiteData();var d=this._aspectSiteAPI.getWixCodeAppApi();var e=a.get(c,["currentUrl","query","viewerPlatformAppSources"]);var f=b.appsUtils.getAppsBaseInfo(c.getClientSpecMap(),c.serviceTopology,e);d.init(c,c.getClientSpecMap(),{isMobileView:c.isMobileView(),debug:c.isDebugMode(),sdkSource:a.get(c,["currentUrl","query","sdkSource"]),runtimeSource:a.get(c,["currentUrl","query","WixCodeRuntimeSource"]),applications:f})}};return c});define("wixCode/handlers/wixCodeHandlers",["lodash","utils","experiment"],function(a,b,c){"use strict";var d=function(a){switch(a.link.type){case"PageLink":return"PAGE";case"ExternalLink":case"EmailLink":case"AnchorLink":case"DocumentLink":return"LINK"}};var e=function(b){switch(b.link.type){case"PageLink":return"/"+b.link.pageId.pageUriSEO;case"ExternalLink":return b.link.url;case"AnchorLink":var c=function(b){switch(b){case"SCROLL_TO_BOTTOM":return"#bottom";case"SCROLL_TO_TOP":return"#top";default:return a.isObject(b)?"#"+b.id:b}};var d=b.link.pageId.pageUriSEO?"/"+b.link.pageId.pageUriSEO:"";var e=b.link.anchorDataId?c(b.link.anchorDataId):"";return d+e;case"DocumentLink":return"document://"+b.link.docId;case"EmailLink":return"mailto:"+b.link.recipient}};var f=function(b){return a.map(b,function(b){var c={$type:"HEADER",title:b.label||"",children:f(b.items)};if(b.link){a.assign(c,{$type:d(b),url:e(b)})}return c})};var g=function(a,c,d){var e=b.menuUtils.getSiteMenuWithoutRenderedLinks(a.getSiteData(),false);d(f(e))};var h=function(a,b,c){c(a.getSiteData().getCurrentUrl())};var i=function(a,b){return a.getSiteData().findDataOnMasterPageByPredicate(function(a){return a.pageUriSEO===b||a.id===b})};var j=function(a,b){var c=a.getSiteData();var d=c.renderFlags.isExternalNavigationAllowed;if(!b||!d){var e=c.renderRealtimeConfig.previewTooltipCallback;e(k(50,20),"text_editor_inactive_link_on_preview");return}window.location.href=b};var k=function(a,b){var c=window.screenLeft!==undefined?window.screenLeft:window.screen.left;var d=window.screenTop!==undefined?window.screenTop:window.screen.top;var e;var f;if(window.innerWidth){e=window.innerWidth}else{e=document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width}if(window.innerHeight){f=window.innerHeight}else{f=document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height}var g=e/2-a/2+c;var h=f/2-b/2+d;return{top:h,left:g}};var l=function(b,d){if(d.data.type==="ExternalLink"){j(b,d.data.url)}var e={pageId:b.getSiteData().getPrimaryPageId()};if(d.data.pageId){if(d.data.pageId==="#"){a.assign(e,{pageId:b.getSiteData().getMainPageId()})}else{var f=i(b,d.data.pageId);if(c.isOpen("sv_dpages")&&!f){var g=d.data.pageId.split("/");var h=a.find(a.get(b.getSiteData(),"rendererModel.routers.configMap"),{prefix:a.first(g)});if(h){e={routerDefinition:h,innerRoute:a.drop(g).join("/"),pageAdditionalData:d.data.pageId}}}else{a.assign(e,{pageId:f.id==="masterPage"?e.pageId:f.id})}}}if(d.data.anchorDataId){a.assign(e,{anchorData:d.data.anchorDataId})}b.handleNavigation(e,"#",true)};var m=function(a,b,c){c({window:a.getWindowSize(),scroll:a.getSiteScroll(),document:a.getDocumentSize()})};return{windowBoundingRect:m,navigateTo:l,getSiteMenu:g,getFullPageUrl:h}});define("wixCode/services/wixCodeAppsAPIService",["lodash"],function(a){"use strict";var b={};var c=function(c,d,e,f){if(a.get(b,c)){b[c][d].apply(null,e).then(function(a){f(a)})}};var d=function(a,c){b[a]=c};return{invokeAppFunctionFor:c,setAppAPI:d}});define("wixCode/utils/wixCodeWindowGlobal",[],function(){"use strict";return typeof window!=="undefined"&&window});define("wixCode/utils/constants",[],function(){"use strict";return{MESSAGE_INTENT:{WIX_CODE_MESSAGE:"WIX_CODE",WIX_CODE_SITE_API:"WIX_CODE_SITE_API",WIX_CODE_APP_API:"WIX_CODE_APP_API"},MESSAGE_TYPE:{CONSOLE:"console",IFRAME_COMMAND:"wix_code_iframe_command",GOOGLE_ANALYTICS:"googleAnalytics"}}});define("wixCode/utils/messageBuilder",["lodash","wixCode/utils/constants"],function(a,b){"use strict";function c(a,b){if(a.type==="load_widgets"){return{appConfig:{scari:b.signedAppRenderInfo}}}}function d(d,e){var f={intent:b.MESSAGE_INTENT.WIX_CODE_MESSAGE};if(d.widgets){var g=c(d,e);d.widgets=a.map(d.widgets,function(b){return b.type==="Application"?b:a.assign({},b,g)})}return a.defaults({},d,f)}return{getExtendedMessage:d}});define("wixCode/aspects/wixCodePostMessageService",["lodash","pmrpc","tpa","utils","wixCode/handlers/wixCodeHandlers","wixCode/services/wixCodeAppsAPIService","wixCode/utils/wixCodeWindowGlobal","wixCode/utils/constants","wixCode/utils/messageBuilder","widgets"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return a===h.MESSAGE_INTENT.WIX_CODE_MESSAGE}function l(a){return a===h.MESSAGE_INTENT.WIX_CODE_SITE_API}function m(a){return a===h.MESSAGE_INTENT.WIX_CODE_APP_API}function n(a){return j.widgetService.getWidgetHandler(a)}function o(a){if(g.parent&&g.parent!==g){g.parent.postMessage(JSON.stringify(a),"*")}}function p(a,b,c){var e=n(a);switch(b.type){case h.MESSAGE_TYPE.IFRAME_COMMAND:e.onCommand(b,c);break;case h.MESSAGE_TYPE.CONSOLE:o(b);break;case h.MESSAGE_TYPE.GOOGLE_ANALYTICS:d.logger.reportGoogleAnalytics.apply(null,[a.getSiteData()].concat(b.data));break;default:e.handleRemoteMessage(b);break}}function q(d,e,g){var h=a.get(e.data,"compId");var i=d.getComponentById(h);if(i){switch(e.type){case"invokeAppFn":f.invokeAppFunctionFor(h,e.data.fn,e.data.fnArgs,g);break;case"getAppAPI":b.api.get({appId:h,initiator:h+"iframe"}).then(function(a){f.setAppAPI(h,a);g(Object.keys(a))});var j=i.getIframe();if(j){c.common.tpaPostMessageCommon.callPostMessage(j,{getAPI:true,compId:h})}else{throw new Error("No iframe found for component",i)}break;default:break}}else{throw new Error("No component found for message",e.data)}}function r(b,d,f){try{if(a.isString(d)){d=JSON.parse(d)}}catch(a){return}if(d){if(k(d.intent)){f(d,s(d,n(b)))}else if(l(d.intent)){var g=a.assign({},c.tpaHandlers,e);if(g[d.type]){g[d.type](b,d,s(d,n(b)))}}else if(m(d.intent)){q(b,d,s(d,n(b)))}}}function s(b,c){return function(d){var e={intent:"WIX_CODE_RESPONSE",callbackId:b.callbackId,type:b.type,contextId:b.contextId};if(l(b.intent)||m(b.intent)){e=a.merge(e,{result:d})}else{e=a.merge(e,{result:{compName:b.compName,command:b.command}})}try{c.updateComponent(e)}catch(a){}}}function t(b,c,d){r(b,c,d||a.partial(p,b))}function u(b,c){var d=a.get(b.getSiteData(),["rendererModel","wixCodeModel"]);return i.getExtendedMessage(c,d)}function v(b,c){j.widgetService.registerWidgetMessageHandler(b,a.partial(c,b))}function w(b,c){j.widgetService.registerWidgetMessageModifier(b,a.partial(c,b))}return{handleMessage:t,modifyPostMessage:u,registerMessageHandler:v,registerMessageModifier:w}});define("wixCode/aspects/WixCodePostMessageAspect",["wixCode/aspects/wixCodePostMessageService"],function(a){"use strict";return function b(c){this.siteAPI=c;a.registerMessageHandler(this.siteAPI,a.handleMessage);a.registerMessageModifier(this.siteAPI,a.modifyPostMessage)}});define("wixCode/aspects/wixCodeAspectCollector",["core","wixCode/aspects/WixCodeWidgetAspect","wixCode/aspects/WixCodePostMessageAspect"],function(a,b,c){"use strict";var d=a.siteAspectsRegistry;d.registerSiteAspect("wixCodeWidgetAspect",b);d.registerSiteAspect("wixCodePostMessageAspect",c)});define("wixCode/utils/kibanaReporter",["lodash","utils"],function a(b,c){"use strict";var d={INFO:"info",ERROR:"error"};function e(a,d){var e=b.clone(a);e=f(e);var g={protocol:"http:",hostname:"monitoringhub."+d,path:"/logstash/events/gost",query:e,hash:""};var h=c.urlUtils.buildFullUrl(g);var i=new window.Image(0,0);i.src=h}function f(a){var c=b.clone(a);if(b.isError(c.message)){c.message=c.message.stack}if(c.hasOwnProperty("message")&&!b.isString(c.message)){c.message=JSON.stringify(c.message)}var d={message:512};b.forEach(d,function(d,e){if(b.isString(a[e])){c[e]=c[e].substr(0,Math.min(c[e].length,d))}});return c}function g(){return{source:"wix-code-client",level:d.INFO,userActionId:c.guidUtils.getGUID()}}function h(a){if(!b.isString(a)||a.length===0){throw new Error("parameter `baseDomain` is invalid, received: "+a)}}function i(a,c){h(c);var d=new Date;var f=d.getTime();var i=b.assign({},g(),a,{timestamp:d.toJSON(),actionPosition:"start"});e(i,c);return function(a){var d=new Date;var g=d.getTime();var h=(g-f)/1e3;a=b.assign({},i,a,{timestamp:d.toJSON(),duration:h,actionPosition:"end"});e(a,c)}}return{levels:d,trace:i}});define("wixCode",["wixCode/utils/wixCodeWidgetService","wixCode/aspects/wixCodeAspectCollector","wixCode/utils/messageBuilder","wixCode/utils/kibanaReporter","wixCode/aspects/wixCodePostMessageService"],function(a,b,c,d,e){"use strict";return{wixCodeWidgetService:a,log:d,messageBuilder:c,wixCodePostMessageService:e}});